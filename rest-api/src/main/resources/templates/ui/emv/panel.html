<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>EMV/CAP Operator Panel</title>
  </head>
  <body>
    <section
        th:fragment="emvPanel(visible)"
        id="protocol-panel-emv"
        class="protocol-panel"
        data-protocol-panel="emv"
        aria-labelledby="protocol-tab-emv"
        th:attr="hidden=${visible == null || !visible} ? 'hidden' : null, aria-hidden=${visible == null || !visible} ? 'true' : null"
      >
      <div class="stack-lg">
        <div
            class="ocra-mode-toggle"
            data-testid="emv-console-tabs"
            role="tablist"
            aria-label="EMV/CAP interaction modes"
          >
          <button
              type="button"
              class="mode-pill mode-pill--active"
              id="emv-console-tab-evaluate"
              data-testid="emv-console-tab-evaluate"
              data-emv-panel-target="evaluate"
              role="tab"
              aria-selected="true"
              aria-controls="emv-evaluate-panel"
            >
            Evaluate
          </button>
          <button
              type="button"
              class="mode-pill"
              id="emv-console-tab-replay"
              data-testid="emv-console-tab-replay"
              data-emv-panel-target="replay"
              role="tab"
              aria-selected="false"
              aria-controls="emv-replay-panel"
            >
            Replay
          </button>
        </div>

        <section
            id="emv-evaluate-panel"
            class="card-shell"
            data-testid="emv-card-shell"
            data-emv-panel="evaluate"
            role="tabpanel"
            aria-labelledby="emv-console-tab-evaluate"
          >
          <div class="card-shell__body section-columns">
            <div class="stack-lg">
              <h2 class="section-title">Evaluate an EMV/CAP OTP</h2>
              <form
                  class="evaluation-form stack-lg"
                  data-testid="emv-form"
                  th:attr="data-evaluate-endpoint=${emvEvaluateEndpoint},data-stored-endpoint=${emvStoredEvaluateEndpoint},data-credentials-endpoint=${emvCredentialsEndpoint},data-seed-endpoint=${emvSeedEndpoint}"
                >
                <input type="hidden" name="_csrf" th:value="${csrfToken}" />
                <script
                    type="application/json"
                    id="emv-seed-definitions"
                    th:utext="${emvSeedDefinitionsJson}"
                  ></script>

                <fieldset
                    class="mode-toggle"
                    data-testid="emv-evaluate-mode-toggle"
                    data-mode="inline"
                  >
                  <legend>Choose evaluation mode</legend>
                  <div class="mode-option">
                    <input
                        type="radio"
                        id="emvEvaluateModeInline"
                        name="emvEvaluateMode"
                        value="inline"
                        data-testid="emv-mode-select-inline"
                        aria-describedby="emvEvaluateModeInlineHint"
                        checked="checked"
                      />
                    <label for="emvEvaluateModeInline">Inline parameters</label>
                    <p id="emvEvaluateModeInlineHint" class="hint">
                      Provide master key, derivation parameters, and customer inputs manually.
                    </p>
                  </div>
                  <div class="mode-option">
                    <input
                        type="radio"
                        id="emvEvaluateModeStored"
                        name="emvEvaluateMode"
                        value="stored"
                        data-testid="emv-mode-select-stored"
                        aria-describedby="emvEvaluateModeStoredHint"
                      />
                    <label for="emvEvaluateModeStored">Stored credential</label>
                    <p id="emvEvaluateModeStoredHint" class="hint">
                      Evaluate a stored EMV/CAP preset. Editing parameters falls back to inline overrides.
                    </p>
                  </div>
                </fieldset>

                <div class="stack-md stack-offset-top-lg evaluation-form__preset-block">
                  <div class="inline-preset" data-testid="emv-evaluate-sample-vector">
                    <label for="emvStoredCredentialId">Load a sample vector</label>
                    <select
                        id="emvStoredCredentialId"
                        name="storedCredentialId"
                        data-testid="emv-stored-credential-select"
                      >
                      <option value="">Select a sample</option>
                    </select>
                    <p class="hint">
                      Selecting a sample loads canonical CAP keys, derivation values, and customer inputs.
                    </p>
                    <div class="seed-actions seed-actions--inline" data-testid="emv-seed-actions">
                      <button type="button" class="button-secondary" data-testid="emv-seed-credentials">
                        Seed sample credentials
                      </button>
                      <p class="hint" data-testid="emv-seed-status" aria-live="polite"></p>
                    </div>
                  </div>
                </div>

                <fieldset class="emv-session-block stack-md" data-testid="emv-session-block">
                  <legend class="field-legend">Session key derivation</legend>
                  <div class="field-grid emv-parameter-grid">
                    <div class="emv-session-row emv-session-master-row" data-testid="emv-master-atc-row">
                      <div class="emv-session-master-column">
                        <div class="field-group">
                          <label for="emvMasterKey">ICC master key (hex)</label>
                          <input
                              type="text"
                              id="emvMasterKey"
                              name="masterKey"
                              data-testid="emv-master-key"
                              spellcheck="false"
                              autocapitalize="none"
                              autocomplete="off"
                            />
                        </div>
                        <div
                            class="secret-mask stack-xs"
                            data-testid="emv-master-key-mask"
                            data-emv-mask="masterKey"
                            hidden="hidden"
                            aria-hidden="true"
                          >
                          <code data-mask-value>—</code>
                          <p class="hint">Stored presets hide this master key. Switch to inline parameters to edit.</p>
                        </div>
                      </div>
                      <div class="field-group">
                        <label for="emvAtc">Application Transaction Counter (hex)</label>
                        <input
                            type="text"
                            id="emvAtc"
                            name="atc"
                            data-testid="emv-atc"
                            autocomplete="off"
                          />
                      </div>
                    </div>
                    <div class="emv-session-row emv-session-pair-row" data-testid="emv-branch-height-row">
                      <div class="field-group">
                        <label for="emvBranchFactor">Branch factor (b)</label>
                        <input
                            type="number"
                            id="emvBranchFactor"
                            name="branchFactor"
                            min="1"
                            data-testid="emv-branch-factor"
                          />
                      </div>
                      <div class="field-group">
                        <label for="emvHeight">Height (H)</label>
                        <input
                            type="number"
                            id="emvHeight"
                            name="height"
                            min="1"
                            data-testid="emv-height"
                          />
                      </div>
                    </div>
                    <div class="field-group emv-field--full">
                      <label for="emvIv">Initialization vector (hex)</label>
                      <input
                          type="text"
                          id="emvIv"
                          name="iv"
                          spellcheck="false"
                          autocapitalize="none"
                          autocomplete="off"
                          data-testid="emv-iv"
                        />
                    </div>
                  </div>
                </fieldset>

                <fieldset class="emv-card-block stack-md" data-testid="emv-card-block">
                  <legend class="field-legend">Card configuration</legend>
                  <div class="field-grid emv-parameter-grid">
                    <div class="field-group emv-field--full">
                      <label for="emvCdol1">CDOL1 payload (hex)</label>
                      <textarea
                          id="emvCdol1"
                          name="cdol1"
                          rows="2"
                          spellcheck="false"
                          autocapitalize="none"
                          autocomplete="off"
                          data-testid="emv-cdol1"
                        ></textarea>
                    </div>
                    <div
                        class="secret-mask stack-xs"
                        data-testid="emv-cdol1-mask"
                        data-emv-mask="cdol1"
                        hidden="hidden"
                        aria-hidden="true"
                      >
                      <code data-mask-value>—</code>
                      <p class="hint">Stored presets hide this CDOL1 payload. Switch to inline parameters to edit.</p>
                    </div>
                    <div class="field-group emv-field--full">
                      <label for="emvIpb">Issuer Proprietary Bitmap (hex)</label>
                      <input
                          type="text"
                          id="emvIpb"
                          name="issuerProprietaryBitmap"
                          spellcheck="false"
                          autocapitalize="none"
                          autocomplete="off"
                          data-testid="emv-ipb"
                        />
                    </div>
                    <div
                        class="secret-mask stack-xs"
                        data-testid="emv-ipb-mask"
                        data-emv-mask="issuerProprietaryBitmap"
                        hidden="hidden"
                        aria-hidden="true"
                      >
                      <code data-mask-value>—</code>
                      <p class="hint">Stored presets hide this issuer bitmap. Switch to inline parameters to edit.</p>
                    </div>
                  </div>
                </fieldset>

                <fieldset class="emv-transaction-block stack-md" data-testid="emv-transaction-block">
                  <legend class="field-legend">Transaction</legend>
                  <p class="hint" data-testid="emv-transaction-hint">
                    "xxxx" is replaced by the ATC before the ICC payload template is evaluated.
                  </p>
                  <div class="field-grid emv-transaction-grid">
                    <div class="field-group emv-field--full">
                      <label for="emvIccTemplate">ICC payload template</label>
                      <textarea
                          id="emvIccTemplate"
                          name="iccDataTemplate"
                          rows="2"
                          spellcheck="false"
                          autocapitalize="none"
                          autocomplete="off"
                          data-testid="emv-icc-template"
                        ></textarea>
                    </div>
                    <div
                        class="secret-mask stack-xs"
                        data-testid="emv-icc-template-mask"
                        data-emv-mask="iccDataTemplate"
                        hidden="hidden"
                        aria-hidden="true"
                      >
                      <code data-mask-value>—</code>
                      <p class="hint">Stored presets hide this ICC template. Switch to inline parameters to edit.</p>
                    </div>
                    <div class="field-group emv-field--full">
                      <label for="emvIssuerApplicationData">Issuer Application Data (hex)</label>
                      <input
                          type="text"
                          id="emvIssuerApplicationData"
                          name="issuerApplicationData"
                          spellcheck="false"
                          autocapitalize="none"
                          autocomplete="off"
                          data-testid="emv-issuer-application-data"
                        />
                    </div>
                    <div
                        class="secret-mask stack-xs"
                        data-testid="emv-issuer-application-data-mask"
                        data-emv-mask="issuerApplicationData"
                        hidden="hidden"
                        aria-hidden="true"
                      >
                      <code data-mask-value>—</code>
                      <p class="hint">Stored presets hide this issuer application data. Switch to inline parameters to edit.</p>
                    </div>
                  </div>
                </fieldset>

                <fieldset
                    class="emv-customer-block stack-md"
                    data-testid="emv-customer-block"
                  >
                  <legend class="field-legend">Input from customer</legend>
                  <span class="emv-customer-mode-label" id="emvCustomerModeLabel">Mode</span>
                  <div
                      class="emv-customer-grid"
                      data-testid="emv-customer-inputs"
                      role="group"
                      aria-labelledby="emvCustomerModeLabel"
                    >
                    <div class="emv-customer-row" data-testid="emv-row-identify">
                      <div class="mode-option" data-mode="IDENTIFY">
                        <input
                            type="radio"
                            id="emvModeIdentify"
                            name="mode"
                            value="IDENTIFY"
                            checked="checked"
                            data-testid="emv-mode-identify"
                          />
                        <label for="emvModeIdentify">Identify</label>
                      </div>
                      <div class="emv-customer-fields" aria-hidden="true">
                        <p class="hint emv-customer-placeholder">No inputs required.</p>
                      </div>
                    </div>
                    <div class="emv-customer-row" data-testid="emv-row-respond">
                      <div class="mode-option" data-mode="RESPOND">
                        <input
                            type="radio"
                            id="emvModeRespond"
                            name="mode"
                            value="RESPOND"
                            data-testid="emv-mode-respond"
                          />
                        <label for="emvModeRespond">Respond</label>
                      </div>
                      <div class="emv-customer-fields">
                        <div class="field-group emv-customer-field" data-field="challenge" data-testid="emv-challenge-group">
                          <label for="emvChallenge">Challenge (digits)</label>
                          <input type="text" id="emvChallenge" name="challenge" data-testid="emv-challenge" autocomplete="off" />
                        </div>
                      </div>
                    </div>
                    <div class="emv-customer-row" data-testid="emv-row-sign">
                      <div class="mode-option" data-mode="SIGN">
                        <input
                            type="radio"
                            id="emvModeSign"
                            name="mode"
                            value="SIGN"
                            data-testid="emv-mode-sign"
                          />
                        <label for="emvModeSign">Sign</label>
                      </div>
                      <div class="emv-customer-fields emv-customer-fields--dual">
                        <div class="field-group emv-customer-field" data-field="reference" data-testid="emv-reference-group">
                          <label for="emvReference">Reference (digits)</label>
                          <input type="text" id="emvReference" name="reference" data-testid="emv-reference" autocomplete="off" />
                        </div>
                        <div class="field-group emv-customer-field" data-field="amount" data-testid="emv-amount-group">
                          <label for="emvAmount">Amount (digits)</label>
                          <input type="text" id="emvAmount" name="amount" data-testid="emv-amount" autocomplete="off" />
                        </div>
                      </div>
                    </div>
                  </div>
                </fieldset>

                <p class="field-legend" id="emvPreviewWindowLegend">
                  Preview window offsets
                </p>
                <div
                    class="field-grid preview-offset-grid"
                    aria-labelledby="emvPreviewWindowLegend"
                    data-testid="emv-preview-window-grid"
                  >
                  <div class="field-group">
                    <label for="emvWindowBackward">Backward steps</label>
                    <input
                        type="number"
                        id="emvWindowBackward"
                        name="previewWindowBackward"
                        min="0"
                        step="1"
                        inputmode="numeric"
                        value="0"
                        data-testid="emv-window-backward"
                      />
                  </div>
                  <div class="field-group">
                    <label for="emvWindowForward">Forward steps</label>
                    <input
                        type="number"
                        id="emvWindowForward"
                        name="previewWindowForward"
                        min="0"
                        step="1"
                        inputmode="numeric"
                        value="0"
                        data-testid="emv-window-forward"
                      />
                  </div>
                </div>

                <div class="emv-action-bar stack-offset-top-lg" data-testid="emv-action-bar">
                  <button type="submit" class="button-primary" data-testid="emv-evaluate-submit">
                    Evaluate inline parameters
                  </button>
                </div>
              </form>
            </div>

            <div class="status-column stack-md">
              <section
                  class="result-panel"
                  data-testid="emv-result-card"
                  aria-live="polite"
                  aria-labelledby="emv-result-heading"
                  hidden="hidden"
                >
                <div class="result-header">
                  <h3 id="emv-result-heading" class="result-card__title">CAP result</h3>
                  <span class="status-badge" data-testid="emv-status">—</span>
                </div>
                <div
                    class="result-preview"
                    data-result-preview
                    data-preview-accent="emv"
                    hidden="hidden"
                    aria-hidden="true"
                  >
                  <table class="result-preview__table" data-testid="emv-preview-table">
                    <caption class="visually-hidden">Preview of neighbouring CAP OTP values.</caption>
                    <thead>
                      <tr>
                        <th scope="col" class="result-preview__heading result-preview__heading--counter">Counter</th>
                        <th scope="col" class="result-preview__heading result-preview__heading--delta">
                          <abbr title="Delta">Δ</abbr>
                        </th>
                        <th scope="col" class="result-preview__heading result-preview__heading--otp">OTP</th>
                      </tr>
                    </thead>
                    <tbody data-result-preview-body data-testid="emv-preview-body"></tbody>
                  </table>
                </div>
                <div class="result-message" data-result-message hidden aria-hidden="true"></div>
                <p class="hint result-message__hint" data-result-hint hidden aria-hidden="true"></p>
              </section>

            </div>
          </div>
        </section>

        <section
            id="emv-replay-panel"
            class="card-shell"
            data-testid="emv-replay-panel"
            data-emv-panel="replay"
            role="tabpanel"
            aria-labelledby="emv-console-tab-replay"
            hidden="hidden"
            aria-hidden="true"
          >
          <div class="card-shell__body section-columns">
            <div class="stack-lg">
              <h2 class="section-title">Replay an EMV/CAP OTP</h2>
              <fieldset class="mode-toggle mode-toggle--compact" data-testid="emv-replay-mode-toggle" data-mode="inline">
                <legend>Choose replay mode</legend>
                <div class="mode-option" data-testid="emv-replay-mode-inline">
                  <input
                      type="radio"
                      id="emvReplayModeInline"
                      name="emvReplayMode"
                      value="inline"
                      aria-describedby="emvReplayModeInlineHint"
                      checked="checked"
                    />
                  <label for="emvReplayModeInline">Inline parameters</label>
                  <p id="emvReplayModeInlineHint" class="hint">Manual replay with full CAP derivation inputs.</p>
                </div>
                <div class="mode-option" data-testid="emv-replay-mode-stored">
                  <input
                      type="radio"
                      id="emvReplayModeStored"
                      name="emvReplayMode"
                      value="stored"
                      aria-describedby="emvReplayModeStoredHint"
                    />
                  <label for="emvReplayModeStored">Stored credential</label>
                  <p id="emvReplayModeStoredHint" class="hint">Replay a seeded preset without advancing ATC.</p>
                </div>
              </fieldset>

              <form
                  class="stack-lg"
                  data-testid="emv-replay-form"
                  th:attr="data-replay-endpoint=${emvReplayEndpoint},data-credentials-endpoint=${emvCredentialsEndpoint}"
                >
                <input type="hidden" name="_csrf" th:value="${csrfToken}" />

                <div class="stack-md stack-offset-top-lg" data-replay-section="stored">
                  <div class="inline-preset" data-testid="emv-replay-sample-vector">
                    <label for="emvReplayStoredCredentialId">Load a sample vector</label>
                    <select
                        id="emvReplayStoredCredentialId"
                        name="credentialId"
                        data-testid="emv-replay-stored-credential-select"
                      >
                      <option value="">Select a sample</option>
                    </select>
                    <p class="hint" data-testid="emv-replay-stored-hint" aria-live="polite">
                      Selecting a sample loads its canonical CAP parameters; adjust values below before replaying.
                    </p>
                  </div>
                </div>

                <fieldset class="emv-session-block stack-md" data-testid="emv-replay-session-block">
                  <legend class="field-legend">Session key derivation</legend>
                  <div class="field-grid emv-parameter-grid">
                    <div class="emv-session-row emv-session-master-row" data-testid="emv-replay-master-atc-row">
                      <div class="emv-session-master-column">
                        <div class="field-group" data-testid="emv-replay-master-key">
                          <label for="emvReplayMasterKey">ICC master key (hex)</label>
                          <input
                              type="text"
                              id="emvReplayMasterKey"
                              name="replayMasterKey"
                              spellcheck="false"
                              autocapitalize="none"
                              autocomplete="off"
                            />
                        </div>
                        <div
                            class="secret-mask stack-xs"
                            data-testid="emv-replay-master-key-mask"
                            data-emv-mask="masterKey"
                            hidden="hidden"
                            aria-hidden="true"
                          >
                          <code data-mask-value>—</code>
                          <p class="hint">Stored presets hide this master key. Switch to inline parameters to edit.</p>
                        </div>
                      </div>
                      <div class="field-group" data-testid="emv-replay-atc">
                        <label for="emvReplayAtc">Application Transaction Counter (hex)</label>
                        <input type="text" id="emvReplayAtc" name="replayAtc" autocomplete="off" />
                      </div>
                    </div>
                    <div class="emv-session-row emv-session-pair-row" data-testid="emv-replay-branch-height-row">
                      <div class="field-group" data-testid="emv-replay-branch-factor">
                        <label for="emvReplayBranchFactor">Branch factor (b)</label>
                        <input type="number" id="emvReplayBranchFactor" name="replayBranchFactor" min="1" />
                      </div>
                      <div class="field-group" data-testid="emv-replay-height">
                        <label for="emvReplayHeight">Height (H)</label>
                        <input type="number" id="emvReplayHeight" name="replayHeight" min="1" />
                      </div>
                    </div>
                    <div class="field-group emv-field--full" data-testid="emv-replay-iv">
                      <label for="emvReplayIv">Initialization vector (hex)</label>
                      <input
                          type="text"
                          id="emvReplayIv"
                          name="replayIv"
                          spellcheck="false"
                          autocapitalize="none"
                          autocomplete="off"
                        />
                    </div>
                  </div>
                </fieldset>

                <fieldset class="emv-card-block stack-md" data-testid="emv-replay-card-block">
                  <legend class="field-legend">Card configuration</legend>
                  <div class="field-grid emv-parameter-grid">
                    <div class="field-group emv-field--full" data-testid="emv-replay-cdol1">
                      <label for="emvReplayCdol1">CDOL1 payload (hex)</label>
                      <textarea
                          id="emvReplayCdol1"
                          name="replayCdol1"
                          rows="2"
                          spellcheck="false"
                          autocapitalize="none"
                          autocomplete="off"
                        ></textarea>
                    </div>
                    <div
                        class="secret-mask stack-xs"
                        data-testid="emv-replay-cdol1-mask"
                        data-emv-mask="cdol1"
                        hidden="hidden"
                        aria-hidden="true"
                      >
                      <code data-mask-value>—</code>
                      <p class="hint">Stored presets hide this CDOL1 payload. Switch to inline parameters to edit.</p>
                    </div>
                    <div class="field-group emv-field--full" data-testid="emv-replay-issuer-bitmap">
                      <label for="emvReplayIssuerBitmap">Issuer Proprietary Bitmap (hex)</label>
                      <input
                          type="text"
                          id="emvReplayIssuerBitmap"
                          name="replayIssuerBitmap"
                          spellcheck="false"
                          autocapitalize="none"
                          autocomplete="off"
                        />
                    </div>
                    <div
                        class="secret-mask stack-xs"
                        data-testid="emv-replay-ipb-mask"
                        data-emv-mask="issuerProprietaryBitmap"
                        hidden="hidden"
                        aria-hidden="true"
                      >
                      <code data-mask-value>—</code>
                      <p class="hint">Stored presets hide this issuer bitmap. Switch to inline parameters to edit.</p>
                    </div>
                  </div>
                </fieldset>

                <fieldset class="emv-transaction-block stack-md" data-testid="emv-replay-transaction-block">
                  <legend class="field-legend">Transaction</legend>
                  <p class="hint" data-testid="emv-replay-transaction-hint">
                    "xxxx" is replaced by the ATC before the ICC payload template is evaluated.
                  </p>
                  <div class="field-grid emv-transaction-grid">
                    <div class="field-group emv-field--full" data-testid="emv-replay-icc-template">
                      <label for="emvReplayIccTemplate">ICC payload template</label>
                      <textarea
                          id="emvReplayIccTemplate"
                          name="replayIccTemplate"
                          rows="2"
                          spellcheck="false"
                          autocapitalize="none"
                          autocomplete="off"
                        ></textarea>
                    </div>
                    <div
                        class="secret-mask stack-xs"
                        data-testid="emv-replay-icc-template-mask"
                        data-emv-mask="iccDataTemplate"
                        hidden="hidden"
                        aria-hidden="true"
                      >
                      <code data-mask-value>—</code>
                      <p class="hint">Stored presets hide this ICC template. Switch to inline parameters to edit.</p>
                    </div>
                    <div class="field-group emv-field--full" data-testid="emv-replay-issuer-application-data">
                      <label for="emvReplayIssuerApplicationData">Issuer Application Data (hex)</label>
                      <input
                          type="text"
                          id="emvReplayIssuerApplicationData"
                          name="replayIssuerApplicationData"
                          spellcheck="false"
                          autocapitalize="none"
                          autocomplete="off"
                        />
                    </div>
                    <div
                        class="secret-mask stack-xs"
                        data-testid="emv-replay-issuer-application-data-mask"
                        data-emv-mask="issuerApplicationData"
                        hidden="hidden"
                        aria-hidden="true"
                      >
                      <code data-mask-value>—</code>
                      <p class="hint">Stored presets hide this issuer application data. Switch to inline parameters to edit.</p>
                    </div>
                  </div>
                </fieldset>

                <fieldset
                    class="emv-customer-block stack-md"
                    data-testid="emv-replay-customer-block"
                  >
                  <legend class="field-legend">Customer inputs</legend>
                  <span class="emv-customer-mode-label" id="emvReplayCustomerModeLabel">Mode</span>
                  <div
                      class="emv-customer-grid"
                      data-testid="emv-replay-customer-inputs"
                      role="group"
                      aria-labelledby="emvReplayCustomerModeLabel"
                    >
                    <div class="emv-customer-row" data-testid="emv-replay-row-identify">
                      <div class="mode-option" data-mode="IDENTIFY">
                        <input
                            type="radio"
                            id="emvReplayModeIdentify"
                            name="emvReplayCapMode"
                            value="IDENTIFY"
                            checked="checked"
                            data-testid="emv-replay-mode-identify"
                          />
                        <label for="emvReplayModeIdentify">Identify</label>
                      </div>
                      <div class="emv-customer-fields" aria-hidden="true">
                        <p class="hint emv-customer-placeholder">No inputs required.</p>
                      </div>
                    </div>
                    <div class="emv-customer-row" data-testid="emv-replay-row-respond">
                      <div class="mode-option" data-mode="RESPOND">
                        <input
                            type="radio"
                            id="emvReplayModeRespond"
                            name="emvReplayCapMode"
                            value="RESPOND"
                            data-testid="emv-replay-mode-respond"
                          />
                        <label for="emvReplayModeRespond">Respond</label>
                      </div>
                      <div class="emv-customer-fields">
                        <div
                            class="field-group emv-customer-field"
                            data-field="challenge"
                            data-testid="emv-replay-challenge"
                          >
                          <label for="emvReplayChallenge">Challenge (digits)</label>
                          <input type="text" id="emvReplayChallenge" name="replayChallenge" autocomplete="off" />
                        </div>
                      </div>
                    </div>
                    <div class="emv-customer-row" data-testid="emv-replay-row-sign">
                      <div class="mode-option" data-mode="SIGN">
                        <input
                            type="radio"
                            id="emvReplayModeSign"
                            name="emvReplayCapMode"
                            value="SIGN"
                            data-testid="emv-replay-mode-sign"
                          />
                        <label for="emvReplayModeSign">Sign</label>
                      </div>
                      <div class="emv-customer-fields emv-customer-fields--dual">
                        <div
                            class="field-group emv-customer-field"
                            data-field="reference"
                            data-testid="emv-replay-reference"
                          >
                          <label for="emvReplayReference">Reference (digits)</label>
                          <input type="text" id="emvReplayReference" name="replayReference" autocomplete="off" />
                        </div>
                        <div
                            class="field-group emv-customer-field"
                            data-field="amount"
                            data-testid="emv-replay-amount"
                          >
                          <label for="emvReplayAmount">Amount (digits)</label>
                          <input type="text" id="emvReplayAmount" name="replayAmount" autocomplete="off" />
                        </div>
                      </div>
                    </div>
                  </div>
                </fieldset>

                <div class="field-grid emv-replay-window-grid">
                  <div class="field-group" data-testid="emv-replay-otp">
                    <label for="emvReplayOtp">Provided OTP</label>
                    <input type="text" id="emvReplayOtp" name="replayOtp" inputmode="numeric" autocomplete="off" />
                  </div>
                  <div class="field-group" data-testid="emv-replay-drift-backward">
                    <label for="emvReplayDriftBackward">Preview window (backward)</label>
                    <input type="number" id="emvReplayDriftBackward" name="replayDriftBackward" min="0" value="0" />
                  </div>
                  <div class="field-group" data-testid="emv-replay-drift-forward">
                    <label for="emvReplayDriftForward">Preview window (forward)</label>
                    <input type="number" id="emvReplayDriftForward" name="replayDriftForward" min="0" value="0" />
                  </div>
                </div>

                <div class="emv-action-bar stack-offset-top-lg">
                  <button type="submit" class="button-primary" data-testid="emv-replay-submit">
                    Replay CAP OTP
                  </button>
                </div>
              </form>
            </div>

            <div class="status-column stack-md">
              <section
                  class="result-panel"
                  data-testid="emv-replay-result-card"
                  aria-live="polite"
                  aria-labelledby="emv-replay-result-heading"
                  hidden="hidden"
                >
                <div class="result-header">
                  <h3 id="emv-replay-result-heading" class="result-card__title">Replay result</h3>
                  <span class="status-badge" data-testid="emv-replay-status">—</span>
                </div>
                <div class="stack-sm">
                  <p class="result-value" data-testid="emv-replay-otp">—</p>
                  <p class="hint" data-testid="emv-replay-matched-delta" hidden aria-hidden="true"></p>
                </div>
                <div class="result-message" data-result-message hidden aria-hidden="true"></div>
                <p class="hint result-message__hint" data-testid="emv-replay-reason" hidden aria-hidden="true"></p>
              </section>
            </div>
          </div>
        </section>
      </div>
    </section>
  </body>
</html>
