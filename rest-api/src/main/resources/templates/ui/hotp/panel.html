<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>HOTP Operator Panel</title>
  </head>
  <body>
    <section
        th:fragment="hotpPanel(visible)"
        id="protocol-panel-hotp"
        class="protocol-panel"
        data-protocol-panel="hotp"
        th:attr="hidden=${visible == null || !visible} ? 'hidden' : null, aria-hidden=${visible == null || !visible} ? 'true' : null"
        aria-labelledby="protocol-tab-hotp"
      >
      <div
          class="ocra-mode-toggle"
          data-testid="hotp-panel-tabs"
          role="tablist"
          aria-label="HOTP interaction modes"
        >
        <button
            type="button"
            class="mode-pill mode-pill--active"
            id="hotp-panel-tab-evaluate"
            data-testid="hotp-panel-tab-evaluate"
            data-hotp-panel-target="evaluate"
            role="tab"
            aria-selected="true"
            aria-controls="hotp-evaluate-panel"
          >
          Evaluate
        </button>
        <button
            type="button"
            class="mode-pill"
            id="hotp-panel-tab-replay"
            data-testid="hotp-panel-tab-replay"
            data-hotp-panel-target="replay"
            role="tab"
            aria-selected="false"
            aria-controls="hotp-replay-panel"
          >
          Replay
        </button>
      </div>

      <section
          id="hotp-evaluate-panel"
          class="card-shell"
          data-testid="hotp-evaluate-panel"
          data-hotp-panel="evaluate"
          role="tabpanel"
          aria-labelledby="hotp-panel-tab-evaluate"
        >
        <div class="card-shell__body stack-lg">
          <div class="section-columns">
            <div class="stack-lg">
              <h2 id="hotp-evaluate-heading" class="section-title">Evaluate an HOTP code</h2>

              <fieldset
                  class="mode-toggle"
                  data-testid="hotp-mode-toggle"
                  data-mode="inline"
                >
                <legend>Choose evaluation mode</legend>
                <div class="mode-option">
                  <input
                    type="radio"
                    id="hotpModeInline"
                    name="hotpMode"
                    value="inline"
                    data-testid="hotp-mode-select-inline"
                    aria-describedby="hotpModeInlineHint"
                    checked="checked"
                  />
                  <label for="hotpModeInline">Inline parameters</label>
                  <p id="hotpModeInlineHint" class="hint">
                    Enter HOTP parameters to generate the next OTP without stored credentials.
                  </p>
                </div>
                <div class="mode-option">
                  <input
                    type="radio"
                    id="hotpModeStored"
                    name="hotpMode"
                    value="stored"
                    data-testid="hotp-mode-select-stored"
                    aria-describedby="hotpModeStoredHint"
                  />
                  <label for="hotpModeStored">Stored credential</label>
                  <p id="hotpModeStoredHint" class="hint">
                    Select a stored HOTP credential to generate the next OTP.
                  </p>
                </div>
              </fieldset>

              <section
                  class="stack-md stack-offset-top-lg"
                  data-testid="hotp-inline-evaluation-panel"
                  aria-label="Inline HOTP evaluation form"
                  data-mode-section="inline"
                >
                <form
                    data-testid="hotp-inline-form"
                    class="evaluation-form"
                    th:attr="data-evaluate-endpoint=${hotpInlineEvaluateEndpoint}"
                  >
                  <input type="hidden" name="_csrf" th:value="${csrfToken}" />
                  <script
                    type="application/json"
                    id="hotp-inline-presets"
                    th:utext="${hotpInlinePresetsJson}"
                  ></script>
                  <div class="inline-preset" data-testid="hotp-inline-preset">
                    <label for="hotpInlinePreset">Load a sample vector</label>
                    <select
                      id="hotpInlinePreset"
                      name="hotpInlinePreset"
                      data-testid="hotp-inline-preset-select"
                    >
                      <option value="">Select a sample</option>
                    </select>
                    <p class="hint">
                      Selecting a preset auto-fills the inline fields with illustrative data.
                    </p>
                  </div>
                  <div class="field-grid">
                    <div class="field-group">
                      <label for="hotpInlineSecretHex">Shared secret (hex)</label>
                      <textarea
                        id="hotpInlineSecretHex"
                        name="sharedSecretHex"
                        rows="3"
                        required="required"
                        spellcheck="false"
                        autocapitalize="none"
                      ></textarea>
                    </div>
                  </div>

                  <div
                    class="field-grid hotp-inline-parameter-grid"
                    data-testid="hotp-inline-parameter-grid"
                  >
                    <div class="field-group">
                      <label for="hotpInlineAlgorithm">Hash algorithm</label>
                      <select
                        id="hotpInlineAlgorithm"
                        name="algorithm"
                        class="select-compact"
                        required="required"
                      >
                        <option value="SHA1" selected>SHA-1</option>
                        <option value="SHA256">SHA-256</option>
                        <option value="SHA512">SHA-512</option>
                      </select>
                    </div>
                    <div class="field-group">
                      <label for="hotpInlineDigits">Digits</label>
                      <input
                        id="hotpInlineDigits"
                        name="digits"
                        type="number"
                        min="6"
                        max="8"
                        step="1"
                        value="6"
                        required="required"
                        class="input-compact"
                      />
                    </div>
                    <div class="field-group">
                      <label for="hotpInlineCounter">Counter</label>
                      <input
                        id="hotpInlineCounter"
                        name="counter"
                        type="number"
                        min="0"
                        value="0"
                        required="required"
                        class="input-compact"
                      />
                    </div>
                  </div>

                  <button
                    type="button"
                    class="button-primary"
                    data-testid="hotp-inline-evaluate-button"
                  >
                    Evaluate inline parameters
                  </button>
                </form>
              </section>

              <section
                  class="stack-md"
                  data-testid="hotp-stored-evaluation-panel"
                  aria-label="Stored HOTP credential evaluation form"
                  data-mode-section="stored"
                  hidden="hidden"
                  aria-hidden="true"
                >
                <form
                    data-testid="hotp-stored-form"
                    class="evaluation-form"
                    th:attr="data-evaluate-endpoint=${hotpStoredEvaluateEndpoint},data-credentials-endpoint=${hotpCredentialsEndpoint},data-seed-endpoint=${hotpSeedEndpoint}"
                  >
                  <input type="hidden" name="_csrf" th:value="${csrfToken}" />
                  <script
                    type="application/json"
                    id="hotp-seed-definitions"
                    th:utext="${hotpSeedDefinitionsJson}"
                  ></script>
                  <div
                    class="seed-actions"
                    data-testid="hotp-seed-actions"
                    hidden="hidden"
                    aria-hidden="true"
                    style="margin-top: 1.5rem;"
                  >
                    <button
                      type="button"
                      class="button-secondary"
                      data-testid="hotp-seed-credentials"
                    >
                      Seed sample credentials
                    </button>
                    <p class="hint" data-testid="hotp-seed-hint">
                      Seed sample credentials when the registry is empty or missing canonical
                      presets.
                    </p>
                    <p
                      class="credential-status"
                      data-testid="hotp-seed-status"
                      aria-live="polite"
                      hidden="hidden"
                      aria-hidden="true"
                    ></p>
                  </div>
                  <div class="field-grid">
                    <div>
                      <label for="hotpStoredCredentialId">Credential</label>
                      <select
                        id="hotpStoredCredentialId"
                        name="credentialId"
                        required="required"
                        aria-describedby="hotp-stored-status"
                        data-testid="hotp-stored-credential-select"
                      >
                        <option value="">Loading credentials…</option>
                      </select>
                      <p
                        id="hotp-stored-status"
                        class="hint"
                        data-testid="hotp-stored-status"
                        aria-live="polite"
                      >
                        HOTP credentials will appear once loaded.
                      </p>
                    </div>
                  </div>
                  <button
                    type="button"
                    class="button-primary"
                    data-testid="hotp-stored-evaluate-button"
                  >
                    Evaluate stored credential
                  </button>
                </form>
              </section>
            </div>
            <div class="status-column">
              <section
                  data-testid="hotp-inline-result-panel"
                  class="result-panel"
                  aria-live="polite"
                  aria-labelledby="hotp-inline-result-heading"
                  hidden="hidden"
                >
                <h3 id="hotp-inline-result-heading" data-testid="hotp-result-heading">
                  Evaluation result
                </h3>
                <p class="result-inline" data-testid="hotp-inline-otp-row">
                  OTP:
                  <strong data-testid="hotp-result-otp">—</strong>
                </p>
                <dl class="result-metadata">
                  <div class="result-row">
                    <dt>Status</dt>
                    <dd>
                      <span data-testid="hotp-result-status" class="status-badge"></span>
                    </dd>
                  </div>
                </dl>
              </section>
              <section
                  data-testid="hotp-stored-result-panel"
                  class="result-panel"
                  aria-live="polite"
                  aria-labelledby="hotp-stored-result-heading"
                  hidden="hidden"
                >
                <h3 id="hotp-stored-result-heading">Evaluation result</h3>
                <p class="result-inline" data-testid="hotp-stored-otp-row">
                  OTP:
                  <strong data-testid="hotp-result-otp">—</strong>
                </p>
                <dl class="result-metadata">
                  <div class="result-row">
                    <dt>Status</dt>
                    <dd>
                      <span data-testid="hotp-result-status" class="status-badge"></span>
                    </dd>
                  </div>
                </dl>
              </section>
              <section
                  data-testid="hotp-inline-error-panel"
                  class="error-panel"
                  role="alert"
                  aria-live="assertive"
                  hidden="hidden"
                >
                <h3>Inline evaluation failed</h3>
                <p data-testid="hotp-inline-error"></p>
              </section>
              <section
                  data-testid="hotp-stored-error-panel"
                  class="error-panel"
                  role="alert"
                  aria-live="assertive"
                  hidden="hidden"
                >
                <h3>Stored evaluation failed</h3>
                <p data-testid="hotp-stored-error"></p>
              </section>
            </div>
          </div>
        </div>
      </section>

      <section
          id="hotp-replay-panel"
          class="card-shell"
          data-testid="hotp-replay-panel"
          data-hotp-panel="replay"
          role="tabpanel"
          aria-labelledby="hotp-panel-tab-replay"
          hidden="hidden"
          aria-hidden="true"
        >
        <div class="card-shell__body stack-lg">
          <div class="section-columns">
            <div>
              <h2 id="hotp-replay-heading" class="section-title">Replay an HOTP code</h2>
              <form
                  data-testid="hotp-replay-form"
                  class="evaluation-form"
                  novalidate="novalidate"
                  th:attr="data-replay-endpoint=${hotpReplayEndpoint},data-credentials-endpoint=${hotpCredentialsEndpoint},data-sample-endpoint=${hotpCredentialSampleEndpoint}"
                >
                <input type="hidden" name="_csrf" th:value="${csrfToken}" />
                <fieldset
                    class="mode-toggle"
                    data-testid="hotp-replay-mode-toggle"
                    data-mode="inline"
                  >
                  <legend>Choose replay mode</legend>
                  <div class="mode-option">
                    <input
                      type="radio"
                      id="hotpReplayModeInline"
                      name="hotpReplayMode"
                      value="inline"
                      data-testid="hotp-replay-mode-select-inline"
                      aria-describedby="hotpReplayModeInlineHint"
                      checked="checked"
                    />
                    <label for="hotpReplayModeInline">Inline parameters</label>
                    <p id="hotpReplayModeInlineHint" class="hint">
                      Provide HOTP parameters directly for ad-hoc verification.
                    </p>
                  </div>
                  <div class="mode-option">
                    <input
                      type="radio"
                      id="hotpReplayModeStored"
                      name="hotpReplayMode"
                      value="stored"
                      data-testid="hotp-replay-mode-select-stored"
                      aria-describedby="hotpReplayModeStoredHint"
                    />
                    <label for="hotpReplayModeStored">Stored credential</label>
                    <p id="hotpReplayModeStoredHint" class="hint">
                      Select a persisted credential, and replay the OTP without advancing counters.
                    </p>
                  </div>
                </fieldset>

                <section
                    class="stack-md"
                    data-testid="hotp-replay-stored-panel"
                    data-replay-section="stored"
                    aria-labelledby="hotpReplayStoredLabel"
                  >
                  <div class="field-grid">
                    <div>
                      <label id="hotpReplayStoredLabel" for="hotpReplayStoredCredentialId"
                        >Stored credential</label
                      >
                      <select
                        id="hotpReplayStoredCredentialId"
                        name="credentialId"
                        data-stored-required="true"
                        disabled="disabled"
                      >
                        <option value="">Loading credentials…</option>
                      </select>
                      <div
                        class="seed-actions"
                        data-testid="hotp-replay-sample-actions"
                        hidden="hidden"
                        aria-hidden="true"
                      >
                        <p
                          class="hint credential-status"
                          data-testid="hotp-replay-sample-status"
                          aria-live="polite"
                        ></p>
                      </div>
                    </div>
                    <div>
                      <label for="hotpReplayStoredOtp">One-time password</label>
                      <input
                        id="hotpReplayStoredOtp"
                        name="otp"
                        type="text"
                        inputmode="numeric"
                        minlength="6"
                        maxlength="8"
                        autocomplete="one-time-code"
                        required="required"
                      />
                    </div>
                    <div>
                      <label for="hotpReplayStoredCounter">Counter</label>
                      <input
                        id="hotpReplayStoredCounter"
                        type="number"
                        min="0"
                        step="1"
                        inputmode="numeric"
                        autocomplete="off"
                        aria-describedby="hotpReplayStoredCounterHint"
                      />
                      <p id="hotpReplayStoredCounterHint" class="visually-hidden">
                        Counter value reflects the credential's current moving factor.
                      </p>
                    </div>
                  </div>
                </section>

                <div
                  class="inline-preset"
                  data-testid="hotp-replay-inline-preset"
                  hidden="hidden"
                  aria-hidden="true"
                >
                  <label for="hotpReplayInlinePreset">Load a sample vector</label>
                  <select
                    id="hotpReplayInlinePreset"
                    name="hotpReplayInlinePreset"
                    data-testid="hotp-replay-inline-sample-select"
                  >
                    <option value="">Select a sample</option>
                  </select>
                  <p class="hint">
                    Selecting a preset auto-fills the inline fields with illustrative data.
                  </p>
                </div>

                <section
                    class="stack-md"
                    data-testid="hotp-replay-inline-panel"
                    data-replay-section="inline"
                    hidden="hidden"
                    aria-hidden="true"
                    aria-label="Inline replay inputs"
                  >
                  <div class="field-grid">
                    <div class="field-group">
                      <label for="hotpReplayInlineSecretHex">Shared secret (hex)</label>
                      <textarea
                        id="hotpReplayInlineSecretHex"
                        name="sharedSecretHex"
                        rows="3"
                        spellcheck="false"
                        autocapitalize="none"
                        data-inline-required="true"
                      ></textarea>
                    </div>
                  </div>
                  <div
                    class="field-grid hotp-inline-parameter-grid"
                    data-testid="hotp-replay-inline-parameter-grid"
                  >
                    <div class="field-group">
                      <label for="hotpReplayInlineAlgorithm">Hash algorithm</label>
                      <select
                        id="hotpReplayInlineAlgorithm"
                        name="algorithm"
                        data-inline-required="true"
                      >
                        <option value="SHA1" selected>SHA-1</option>
                        <option value="SHA256">SHA-256</option>
                        <option value="SHA512">SHA-512</option>
                      </select>
                    </div>
                    <div class="field-group">
                      <label for="hotpReplayInlineDigits">Digits</label>
                      <input
                        id="hotpReplayInlineDigits"
                        name="digits"
                        type="number"
                        min="6"
                        max="8"
                        step="1"
                        value="6"
                        data-inline-required="true"
                      />
                    </div>
                    <div class="field-group">
                      <label for="hotpReplayInlineCounter">Counter</label>
                      <input
                        id="hotpReplayInlineCounter"
                        name="counter"
                        type="number"
                        min="0"
                        step="1"
                        value="0"
                        data-inline-required="true"
                      />
                    </div>
                  </div>
                  <div class="field-grid">
                    <div class="field-group">
                      <label for="hotpReplayInlineOtp">One-time password</label>
                      <input
                        id="hotpReplayInlineOtp"
                        name="otp"
                        type="text"
                        inputmode="numeric"
                        minlength="6"
                        maxlength="8"
                        autocomplete="one-time-code"
                        data-inline-required="true"
                      />
                    </div>
                  </div>
                </section>

                <div class="button-row">
                  <button
                    type="button"
                    class="button-primary"
                    data-testid="hotp-replay-submit"
                  >
                    Verify OTP
                  </button>
                </div>
              </form>
            </div>
            <div class="status-column">
              <section
                  class="result-panel"
                  data-testid="hotp-replay-result"
                  hidden="hidden"
                  aria-hidden="true"
                  aria-labelledby="hotpReplayResultHeading"
                >
                <div class="result-header">
                  <h3 id="hotpReplayResultHeading">Replay result</h3>
                  <span class="status-badge" data-testid="hotp-replay-status">—</span>
                </div>
                <dl class="result-metadata">
                  <div class="result-row">
                    <dt>Reason Code</dt>
                    <dd data-testid="hotp-replay-reason-code">—</dd>
                  </div>
                  <div class="result-row">
                    <dt>Outcome</dt>
                    <dd data-testid="hotp-replay-outcome">—</dd>
                  </div>
                </dl>
              </section>

              <div
                  class="error-card"
                  data-testid="hotp-replay-error"
                  hidden="hidden"
                  aria-hidden="true"
                >
                <h3>Replay failed</h3>
                <p data-testid="hotp-replay-error-message"></p>
              </div>
            </div>
          </div>
        </div>
      </section>
    </section>
  </body>
</html>
