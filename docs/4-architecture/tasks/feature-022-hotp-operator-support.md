# Feature 022 – Task Checklist

_Status: Draft_
_Last updated: 2025-10-06_

## Tasks (≤10 min each)
- ☑ T2201 – Add failing HOTP generator/validator unit tests covering counter rollover, digit length variants, and secret bounds.
- ☑ T2202 – Implement HOTP domain logic to satisfy T2201 and extend mutation/ArchUnit coverage.
- ☑ T2203 – Add failing MapDB integration tests mixing OCRA + HOTP credentials via `CredentialStoreFactory`.
- ☑ T2204 – Implement shared persistence updates for HOTP records and make T2203 pass.
- ☑ T2205 – Add failing application-layer tests for HOTP evaluation/issuance telemetry adapters.
- ☑ T2206 – Implement application services and telemetry wiring to satisfy T2205.
- ☑ T2207 – Add failing CLI command tests (import/list/evaluate) asserting telemetry frames.
- ☑ T2208 – Implement CLI HOTP commands and ensure T2207 passes.
- ☑ T2209 – Add failing REST MockMvc tests + OpenAPI snapshot expectations for HOTP evaluation endpoints.
- ☑ T2210 – Implement REST HOTP endpoints, update OpenAPI artifacts, and satisfy T2209.
- ☑ T2211 – Update how-to docs, roadmap highlights, knowledge map, and rerun `./gradlew spotlessApply check` (2025-10-05 run reached Jacoco branch coverage 0.9002 / line 0.9706 after HOTP REST coverage additions).
- ☑ T2212 – Add failing operator console integration/system tests for HOTP stored credential evaluation flows.
- ☑ T2213 – Implement HOTP stored credential evaluation in the operator console and ensure T2212 passes.
- ☑ T2214 – Add failing operator console integration/system tests for HOTP inline evaluation flows plus accessibility assertions.
- ☑ T2215 – Implement HOTP inline evaluation in the operator console and ensure T2214 passes.
- ☑ T2216 – Update operator how-to docs, roadmap notes, knowledge map, and rerun `./gradlew spotlessApply check` after HOTP UI work.
- ☑ T2217 – Add failing REST MockMvc tests + OpenAPI expectations for `POST /api/v1/hotp/replay` (stored + inline) asserting counters remain unchanged and telemetry uses `hotp.replay` (2025-10-05 run: `./gradlew :rest-api:test --tests "io.openauth.sim.rest.HotpReplayEndpointTest"` initially failed pending implementation; see T2218 for the passing follow-up).
- ☑ T2218 – Implement HOTP replay service/controller wiring, ensure counters are read-only, refresh OpenAPI snapshots, and satisfy T2217 (`./gradlew :application:test --tests "io.openauth.sim.application.hotp.HotpReplayApplicationServiceTest"` + `OPENAPI_SNAPSHOT_WRITE=true ./gradlew :rest-api:test --tests "io.openauth.sim.rest.OpenApiSnapshotTest"`, followed by full `./gradlew :rest-api:test`).
- ☑ T2219 – Add failing Selenium coverage for HOTP replay UI (stored + inline) mirroring OCRA behaviour (sample data, advanced toggles, telemetry identifier surfacing).
- ☑ T2220 – Implement HOTP replay UI template/JS wiring and make T2219 pass.
- ☑ T2221 – Update operator docs, roadmap, knowledge map, and telemetry references for HOTP replay; rerun `./gradlew spotlessApply check`.
- ☑ T2222 – Add failing operator console integration/system test asserting HOTP evaluate/replay tab selection writes `protocol=hotp` and `tab=<active>` query params for deep-link restoration. (`./gradlew :rest-api:test --tests "…hotpTabsPersistQueryParameters"` initially red.)
- ☑ T2223 – Implement HOTP operator console query-param updates and ensure T2222 passes. (`./gradlew spotlessApply check` green 2025-10-05; Selenium `hotpReplayDeepLinkSurvivesRefresh` confirms refresh persistence.)
- ☑ T2224 – Update operator console Selenium tests to fail when inline/stored evaluation panels still render headings or hint copy after mode selection (`./gradlew :rest-api:test --tests "io.openauth.sim.rest.ui.OperatorConsoleUnificationSeleniumTest"` red as expected).
- ☑ T2225 – Remove the HOTP evaluation headings/hints from the UI template/JS, adjust accessibility attributes, and make T2224 pass with targeted UI suites plus `./gradlew spotlessApply check` (green 2025-10-05).
- ☑ T2226 – Add failing REST + UI tests ensuring inline HOTP requests omit the identifier field and update OpenAPI expectations accordingly. (2025-10-05: `HotpEvaluationServiceTest`, controller tests, and Selenium coverage updated to expect no identifier.)
- ☑ T2227 – Strip identifier handling from HOTP inline evaluation across REST/application/core layers, update UI payloads, regenerate snapshots, and rerun `./gradlew spotlessApply check`. (2025-10-05: identifier removed; OpenAPI regenerated; build passes save for known spotless tool issue documented in build notes.)
- ☑ T2228 – Force google-java-format 1.28.0 across Spotless and annotation processor configurations, refresh dependency locks, and rerun `./gradlew spotlessApply check` to confirm the formatter mismatch is resolved. (2025-10-05: added resolution strategy force, rewrote locks via targeted compile/compileTest tasks, and verified Spotless/build.)
- ☑ T2229 – Add `com.github.spotbugs:spotbugs-annotations` as a REST API test-only dependency to resolve HtmlUnit `@SuppressFBWarnings` warnings; refresh dependency locks if required. (2025-10-05: dependency added to `testImplementation` with `because` note, regenerated lockfile via targeted `--write-locks` runs, verified `:rest-api:compileTestJava` clean.)
- ☑ T2230 – Add `serialVersionUID` constants to HOTP/OCRA exception classes across application and REST modules, then rerun `./gradlew spotlessApply check` to confirm warnings are cleared. (2025-10-05: added serial IDs, reran `:application:compileJava` and `:rest-api:compileTestJava`; full `spotlessApply check` remains red because `ReflectionRegexScanTest` flags existing reflection helpers in HOTP CLI/REST tests—no new reflection added in this change.)
- ☑ T2231 – Refactor HOTP CLI and REST replay tests to avoid reflection by exposing package-level helpers, then rerun `./gradlew :core-architecture-tests:test --tests "io.openauth.sim.architecture.ReflectionRegexScanTest"` to confirm the guardrail passes. (2025-10-05: tests now call `HotpCli.databasePath()` + `HotpReplayService.hasText/safeMessage`; ran `:cli:test`, `:rest-api:test`, `:core-architecture-tests:test`, and full `spotlessApply check`.)
- ☑ T2232 – Add failing REST + Selenium tests asserting HOTP Evaluate tab removes OTP inputs, returns generated OTP metadata (stored/inline), and surfaces multiple inline presets (SHA-1 + SHA-256). (`./gradlew :application:test --tests "…evaluateInlinePresetMetadataPropagatesToTelemetry"` + `./gradlew :rest-api:test --tests "…HotpEvaluationEndpointTest.inlineHotpEvaluationPresetMetadata"` + Selenium target run executed red before implementation.)
- ☑ T2233 – Implement HOTP generation-first evaluate flow (core/application/REST/UI) with multiple inline presets (SHA-1 + SHA-256), update docs, and rerun `./gradlew spotlessApply check`. (Post-implementation validation: `./gradlew :application:test …`, `./gradlew :rest-api:test …inlineHotpEvaluationPresetMetadata`, `./gradlew :rest-api:test …HotpOperatorUiSeleniumTest.inlineHotpEvaluationSucceeds`; docs refreshed in `docs/2-how-to/use-hotp-operator-ui.md`.)
- ☑ T2234 – Add failing Selenium/UI assertions that HOTP inline evaluation renders the OCRA-style “Evaluation result” card (headline, OTP/status labels, metadata suppression, right-side layout) via `./gradlew :rest-api:test --tests "io.openauth.sim.rest.ui.HotpOperatorUiSeleniumTest"` (2025-10-05: targeted run red with NoSuchElement for heading, confirming legacy markup).
- ☑ T2235 – Update HOTP inline evaluation templates/styles to satisfy T2234 and rerun the targeted UI suite plus `./gradlew spotlessApply check` (2025-10-05: inline result card mirrors OCRA layout; `./gradlew :rest-api:test --tests "io.openauth.sim.rest.ui.HotpOperatorUiSeleniumTest"` and full `./gradlew spotlessApply check` both green).
- ☑ T2236 – Add failing Selenium checks asserting the active HOTP result panel is the first child of the status column (ensuring top-right placement) via `./gradlew :rest-api:test --tests "io.openauth.sim.rest.ui.HotpOperatorUiSeleniumTest"` (2025-10-06: expectation triggered AssertionError before layout changes, confirming precondition).
- ☑ T2237 – Rework HOTP evaluation layout/JS so stored and inline result cards live in the shared status column’s leading position, then rerun the targeted UI suite and `./gradlew spotlessApply check` (2025-10-06: single section-columns wrapper with shared status column; targeted suite + spotless both green).
- ☑ T2238 – Add failing Selenium assertions that HOTP result rows render labels and values on the same line (OTP/status) with the same structure as the OCRA evaluation panel (`./gradlew :rest-api:test --tests "io.openauth.sim.rest.ui.HotpOperatorUiSeleniumTest"` red prior to layout sync on 2025-10-06).
- ☑ T2239 – Update HOTP result markup/styles/scripts to satisfy T2238 (matching OCRA card spacing/typography) and rerun targeted suite plus `./gradlew spotlessApply check` (2025-10-06: result panels now reuse OCRA inline row markup; targeted Selenium suite and full build both green).
- ☑ T2240 – Add failing OCRA Selenium assertions that the evaluation status row uses the shared success badge styling (`./gradlew :rest-api:test --tests "io.openauth.sim.rest.ui.OcraOperatorUiSeleniumTest"` red prior to badge wiring on 2025-10-06).
- ☑ T2241 – Update OCRA evaluation result markup/styles to reuse the success badge, rerun targeted OCRA + HOTP suites and `./gradlew spotlessApply check` (2025-10-06: inline script applies badge variants; targeted suites and full build green).

Mark tasks as work completes and record tooling outcomes within the feature plan.
- ☑ T2242 – Add failing REST + Selenium coverage for the HOTP stored credential seeding button (empty-store scenario, telemetry assertions, idempotency guards).
    (2025-10-06: initial coverage drafted; REST seeding test now passes after endpoint implementation, Selenium seeding test remains red pending UI wiring.)
- ☑ T2243 – Implement HOTP seeding service/REST endpoint mirroring the OCRA flow, append `ui-hotp-demo` and `ui-hotp-demo-sha256` when missing, and satisfy T2242. (2025-10-06: added application + REST seeding services; `./gradlew :application:test --tests "io.openauth.sim.application.telemetry.HotpTelemetryContractTest"` and `./gradlew :rest-api:test --tests "io.openauth.sim.rest.HotpCredentialSeedingEndpointTest"` executed successfully.)
- ☑ T2244 – Wire the operator UI seeding button (stored-mode only) with status messaging, reuse preset metadata, and rerun targeted UI suites to satisfy T2242/T2243. (2025-10-06: added Thymeleaf seed controls + JSON definitions, updated HOTP console JS to call the seeding endpoint and refresh stored credentials/sample hints, then executed `./gradlew :rest-api:test --tests "io.openauth.sim.rest.ui.HotpOperatorUiSeedingSeleniumTest"`.)
- ☑ T2245 – Sync docs/roadmap/knowledge map and rerun `./gradlew spotlessApply check` after HOTP seeding lands. (2025-10-06: updated the HOTP operator UI how-to with the seeding control, refreshed roadmap/knowledge map, and re-executed the formatting/verification task.)
- ☑ T2246 – Add failing Selenium assertions that the HOTP stored-mode “Seed sample credentials” button precedes the stored credential selector (matching OCRA layout) via `./gradlew :rest-api:test --tests "io.openauth.sim.rest.ui.HotpOperatorUiSeedingSeleniumTest"`. (2025-10-06: assertion fails against current layout, confirming precondition.)
- ☑ T2247 – Rework the HOTP evaluate template/JS so the seeding button renders above the selector without altering spacing/copy, then rerun the targeted UI suite and `./gradlew spotlessApply check` to satisfy T2246. (2025-10-06: moved seed-actions block before the credential field grid, added wait guard in Selenium test, reran targeted suite with `--rerun-tasks`, and full build passed.)
- ☑ T2248 – Add failing Selenium assertions requiring a minimum spacing between the HOTP mode selector and the seeding button, mirroring the OCRA layout (`./gradlew :rest-api:test --tests "io.openauth.sim.rest.ui.HotpOperatorUiSeedingSeleniumTest"`). (2025-10-06: assertion red with 0 px margin, confirming precondition.)
- ☑ T2249 – Update shared console styling so the HOTP seeding control inherits the required spacing, satisfy the new Selenium checks, and rerun `./gradlew spotlessApply check`. (2025-10-06: applied inline spacing, refreshed Selenium helpers to avoid stale elements, targeted suite + full spotless/check both green.)
- ☑ T2250 – Add failing operator console Selenium/regression coverage asserting the HOTP Evaluate tab defaults to Inline parameters after initial load and persists after page refresh. (2025-10-06: extended `HotpOperatorUiSeleniumTest` with inline-default + refresh expectations and reran `./gradlew :rest-api:test --tests "io.openauth.sim.rest.ui.HotpOperatorUiSeleniumTest.hotpEvaluateDefaultsToInlineModeAfterRefresh"` to capture the expected failure.)
- ☑ T2251 – Update HOTP operator console templates/JS state to select Inline parameters on initial render and refresh, satisfy the new Selenium coverage, and rerun `./gradlew spotlessApply check`. (2025-10-06: revised HOTP panel markup + console.js defaults, ensured targeted Selenium suites and `./gradlew spotlessApply check` completed successfully.)
- ☑ T2252 – Add failing Selenium regression that enforces the vertical spacing between the HOTP stored-credential selector and the sample vector controls when Inline parameters are active. (2025-10-06: introduced `HotpOperatorUiSeleniumTest.hotpInlineSpacingMatchesOcra` asserting inline form class/style; targeted run failed prior to UI adjustments.)
- ☑ T2253 – Implement HOTP evaluate-tab spacing updates to satisfy T2252 and validate with targeted Selenium suite plus `./gradlew spotlessApply check`. (2025-10-06: applied the shared spacing utility with 0.75rem padding on the inline form, updated console CSS, reran targeted Selenium + full `./gradlew spotlessApply check`, all green.)
