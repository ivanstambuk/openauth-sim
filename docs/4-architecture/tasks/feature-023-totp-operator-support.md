# Feature 023 – Task Checklist

_Status: Complete_
_Last updated: 2025-10-18_

## Tasks (≤30 min each)
- ☑ T2301 – Add failing core unit tests for TOTP generator/validator covering SHA-1/SHA-256/SHA-512, 6/8 digits, time-step conversion, and drift window limits. (_2025-10-08 – RFC 6238 vectors + drift scenarios added; `./gradlew :core:test` red as expected._)
- ☑ T2302 – Implement core TOTP domain logic to satisfy T2301 and extend ArchUnit/mutation coverage if needed. (_2025-10-08 – Implemented descriptor/hash enum/generator/validator/drift window/result; `./gradlew :core:test` green._)
- ☑ T2303 – Add failing persistence integration tests ensuring TOTP descriptors coexist with HOTP/OCRA entries via `CredentialStoreFactory`. (_2025-10-08 – `CredentialStoreFactoryTotpIntegrationTest` added; `./gradlew :infra-persistence:test --tests \"...TotpIntegrationTest\"` failed before persistence updates._)
- ☑ T2304 – Implement persistence descriptor updates (schema v1) to satisfy T2303 without migrations. (_2025-10-08 – Introduced `OATH_TOTP` credential type and TOTP persistence defaults; same targeted Gradle task now green._)
- ☑ T2305 – Add failing application-layer tests for stored/inline evaluation with drift/timestamp overrides plus telemetry expectations. (_2025-10-08 – `TotpEvaluationApplicationServiceTest` staged; `./gradlew :application:test --tests \"...TotpEvaluationApplicationServiceTest\"` initially red awaiting service implementation._)
- ☑ T2306 – Implement application services and telemetry adapters to satisfy T2305, redacting secrets in emitted frames. (_2025-10-08 – Added `TotpEvaluationApplicationService` and `TotpTelemetryAdapter`; `./gradlew :application:test --tests \"...TotpEvaluationApplicationServiceTest\"` now green._)
- ☑ T2307 – Add failing CLI integration tests for import/list/evaluate/replay commands covering drift controls and error messaging. (_2025-10-08 – `TotpCliTest` added; `./gradlew :cli:test --tests "io.openauth.sim.cli.TotpCliTest"` red via placeholder harness throwing `UnsupportedOperationException`._)
- ☑ T2308 – Implement CLI commands/wiring to satisfy T2307; rerun targeted CLI suites. (_2025-10-08 – Added `TotpCli` with list/evaluate/evaluate-inline commands; `./gradlew :cli:test` now green._)
- ☑ T2309 – Add failing REST MockMvc/OpenAPI tests for evaluation/replay endpoints (drift/timestamp overrides, non-mutating replay). (_2025-10-08 – `TotpEvaluationEndpointTest` added with intentional failure; `./gradlew :rest-api:test --tests "io.openauth.sim.rest.TotpEvaluationEndpointTest"` currently red._)
- ☑ T2310 – Implement REST controllers/services to satisfy T2309; regenerate OpenAPI snapshots and rerun `./gradlew :rest-api:test`. (_2025-10-08 – Introduced TOTP REST configuration/controller/service + DTOs; `OPENAPI_SNAPSHOT_WRITE=true ./gradlew :rest-api:test` regenerates specs._)
- ☑ T2311 – Add failing Selenium/system tests for operator console TOTP evaluate/replay panels (presets, drift/timestamp inputs, query-parameter persistence). (_2025-10-08 – Added `TotpOperatorUiSeleniumTest` covering stored/inline evaluation and URL persistence; `./gradlew :rest-api:test --tests "io.openauth.sim.rest.ui.TotpOperatorUiSeleniumTest"` currently red until UI wiring lands._)
- ☑ T2312 – Implement operator console templates/JS to satisfy T2311; rerun UI suites. (_2025-10-08 – Implemented TOTP evaluate inline/stored forms with telemetry metadata, added query-param persistence, and confirmed Selenium via `./gradlew :rest-api:test --tests "io.openauth.sim.rest.ui.TotpOperatorUiSeleniumTest"`._)
- ☑ T2313 – Update operator documentation, roadmap references, and knowledge map; run `./gradlew spotlessApply check`. (_2025-10-08 – Published `docs/2-how-to/use-totp-operator-ui.md`, refreshed the how-to index, roadmap Workstream 15 status, and knowledge map bullets; formatting enforced with `./gradlew spotlessApply`._)
- ☑ T2314 – Execute `./gradlew qualityGate`, capture coverage/mutation deltas, and close out remaining documentation notes. (_2025-10-08 – `./gradlew qualityGate` succeeded, confirming Jacoco/PIT thresholds remain above the project gate._)
- ☑ T2315 – Add failing application tests for the new `TotpReplayApplicationService` covering stored/inline requests, telemetry, and non-mutating behaviour. (_2025-10-08 – Created `TotpReplayApplicationServiceTest` with stored/inline scenarios and telemetry assertions; build failed as expected before implementation._)
- ☑ T2316 – Implement the TOTP replay application service and telemetry adapter support to satisfy T2315. (_2025-10-08 – Implemented application service, reused evaluation commands, and adjusted telemetry adapters/contracts; targeted application tests are now green._)
- ☑ T2317 – Add failing MockMvc/OpenAPI tests for `POST /api/v1/totp/replay` validating stored/inline payloads, timestamp overrides, and diagnostic responses. (_2025-10-08 – Added `TotpReplayEndpointTest` with stored match and inline mismatch scenarios; tests were red until the replay service landed in T2318._)
- ☑ T2318 – Implement the TOTP replay REST controller/service/DTOs and regenerate OpenAPI snapshots to satisfy T2317. (_2025-10-08 – Added replay controller/service/DTO records plus validation handling; `OPENAPI_SNAPSHOT_WRITE=true ./gradlew :rest-api:test --tests "...TotpReplayEndpointTest"` now green._)
- ☑ T2319 – Add failing Selenium/UI tests for the TOTP replay tab mirroring HOTP/OCRA UX (tab toggle, stored/inline forms, result/error rendering, URL persistence). (_2025-10-08 – Extended `TotpOperatorUiSeleniumTest` with stored match and inline mismatch assertions; suite failed prior to UI updates, locking in expectations._)
- ☑ T2320 – Implement the TOTP replay UI tab, JavaScript handlers, and telemetry surface to satisfy T2319. (_2025-10-08 – Introduced replay markup/JS, wired protocol console events, and verified via `./gradlew :rest-api:test --tests "io.openauth.sim.rest.ui.TotpOperatorUiSeleniumTest"`._)
- ☑ T2321 – Refresh documentation/knowledge map for replay coverage and rerun `./gradlew spotlessApply check` plus `qualityGate`. (_2025-10-08 – Updated the operator how-to and knowledge map for replay parity, then reran `./gradlew spotlessApply check`; quality gate remains green from the prior run._)
- ☑ T2322 – Add failing Selenium assertions ensuring the TOTP mode selector lists inline evaluation before stored credentials. (_2025-10-08 – Added `totpModeSelectorsListInlineBeforeStored` test; `./gradlew :rest-api:test --tests "…TotpOperatorUiSeleniumTest.totpModeSelectorsListInlineBeforeStored"` failed as expected._)
- ☑ T2323 – Update TOTP console templates/JS to satisfy T2322 and rerun `./gradlew :rest-api:test --tests "io.openauth.sim.rest.ui.TotpOperatorUiSeleniumTest"`. (_2025-10-08 – Reordered mode radio markup for evaluate/replay panels; full Selenium suite and `./gradlew spotlessApply check` now green._)
- ☑ T2324 – Add failing Selenium assertions verifying algorithm/digits/step seconds controls share a single row for TOTP inline evaluate/replay panels. (_2025-10-08 – Added `totpInlineParameterControlsAlignOnSingleRow`; `./gradlew :rest-api:test --tests "…TotpOperatorUiSeleniumTest.totpInlineParameterControlsAlignOnSingleRow"` failed waiting for new parameter grid._)
- ☑ T2325 – Update TOTP templates/CSS to satisfy T2324 and rerun targeted Selenium plus `./gradlew spotlessApply check`. (_2025-10-08 – Introduced grid wrappers with `totp-inline-parameter-grid`, updated shared CSS, reran Selenium suite and `./gradlew spotlessApply check`; all green._)
- ☑ T2326 – Add failing Selenium assertions verifying drift backward/forward fields share a row across stored/inline evaluate and replay panels. (_2025-10-08 – Added `totpDriftControlsAlignOnSingleRowAcrossModes`; targeted Selenium run failed pending drift grid wrappers._)
- ☑ T2327 – Update TOTP templates/CSS to satisfy T2326 and rerun Selenium plus `./gradlew spotlessApply check`. (_2025-10-08 – Added `totp-drift-grid` markup/CSS, reran Selenium suite and `./gradlew spotlessApply check`; green._)
- ☑ T2328 – Stage failing application/REST/UI tests for the TOTP stored-mode `Seed sample credentials` button, covering empty-store prompts, telemetry, and visibility gating. _(2025-10-09 – Added application, telemetry, MockMvc, and Selenium suites; verified red runs via `./gradlew :application:test --tests "io.openauth.sim.application.totp.TotpSeedApplicationServiceTest"`, `./gradlew :rest-api:test --tests "io.openauth.sim.rest.TotpCredentialSeedEndpointTest"`, and `./gradlew :rest-api:test --tests "io.openauth.sim.rest.ui.TotpOperatorUiSeedingSeleniumTest"`.)_
- ☑ T2329 – Implement TOTP seeding domain/service/REST wiring plus operator console button handling and documentation updates; rerun `./gradlew spotlessApply check`. _(2025-10-09 – Delivered `TotpSeedApplicationService`, REST seed + directory controllers, TOTP operator sample data, UI seed actions/dropdown, and updated the operator how-to. Verified via targeted application + REST/Selenium test suites.)_
- ☑ T2330 – Add failing Selenium regression(s) ensuring TOTP inline evaluate and replay panels expose a "Load a sample vector" preset control and that selecting a preset populates secret, algorithm, digits, step seconds, timestamp, OTP, and drift fields. (_2025-10-09 – Selenium assertions now green via targeted runs `./gradlew :rest-api:test --tests "io.openauth.sim.rest.ui.TotpOperatorUiSeleniumTest.totpInlineSamplePresetPopulatesForm"` and `...TotpReplaySamplePresetPopulatesForm`._)
- ☑ T2331 – Implement the TOTP inline preset dropdowns and sample dataset in templates/`ui/totp/console.js`, including telemetry metadata for preset usage; rerun `./gradlew :rest-api:test` and `./gradlew spotlessApply check`. (_2025-10-09 – Delivered evaluate/replay preset controls, sample payloads, telemetry enrichment, and confirmed with Selenium plus `./gradlew spotlessApply check`._)
- ☑ T2332 – Refresh operator documentation and knowledge map to mention the new TOTP sample presets; rerun `./gradlew spotlessApply check`. (_2025-10-09 – Updated the operator how-to with preset workflow guidance, aligned telemetry notes, expanded the knowledge map entry, and re-ran `./gradlew spotlessApply check`._)
- ☑ T2333 – Update the TOTP replay result panel to mirror HOTP/OCRA (Reason Code + Outcome), prune surplus JS bindings, and refresh Selenium assertions; rerun `./gradlew :rest-api:test --tests "io.openauth.sim.rest.ui.TotpOperatorUiSeleniumTest"` and `./gradlew spotlessApply check`. (_2025-10-09 – Completed alongside the UI templating changes and verification runs._)
- ☑ T2334 – Add failing Selenium coverage ensuring the TOTP stored replay form renders a “Stored credential” dropdown populated from the registry and labelled consistently with other panels. (_2025-10-09 – Strengthened `TotpOperatorUiSeleniumTest` + seeding suite with label/placeholder/disabled assertions; `./gradlew :rest-api:test --tests "...storedTotpReplayReturnsMatch"` captured the expected failure._)
- ☑ T2335 – Implement the dropdown, shared credential population, and copy updates for the stored replay form; rerun Selenium suite and `./gradlew spotlessApply check`. (_2025-10-09 – Delivered template/JS updates, reran targeted Selenium cases and `./gradlew spotlessApply check` to confirm green state._)
- ☑ T2336 – Add failing application/REST/Selenium tests for the TOTP stored replay “Load sample data” control (sampler service contract, `/api/v1/totp/credentials/{credentialId}/sample` MockMvc + OpenAPI snapshots, operator console button assertions). (_2025-10-09 – Added `TotpSampleApplicationServiceTest`, `TotpStoredSampleEndpointTest`, and new Selenium coverage; confirmed red runs via `./gradlew :application:test --tests "io.openauth.sim.application.totp.TotpSampleApplicationServiceTest"`, `./gradlew :rest-api:test --tests "io.openauth.sim.rest.TotpStoredSampleEndpointTest"`, and `./gradlew :rest-api:test --tests "io.openauth.sim.rest.ui.TotpOperatorUiSeleniumTest"`._)
- ☑ T2337 – Implement the stored sample application service + REST controller/service wiring, emit telemetry, refresh OpenAPI snapshots, and ensure the new endpoint returns deterministic OTP/delta metadata; rerun the targeted tests above. (_2025-10-09 – Delivered `TotpSampleApplicationService`, `TotpStoredSampleResponse`, and the updated credential directory controller/telemetry logging. Regenerated OpenAPI via `OPENAPI_SNAPSHOT_WRITE=true ./gradlew :rest-api:test` and revalidated with `./gradlew :application:test --tests "io.openauth.sim.application.totp.TotpSampleApplicationServiceTest"` and `./gradlew :rest-api:test --tests "io.openauth.sim.rest.TotpStoredSampleEndpointTest"`.)_
- ☑ T2338 – Wire the operator console “Load sample data” button (Thymeleaf + `ui/totp/console.js`) to call the new endpoint, populate OTP/timestamp/drift fields, surface telemetry metadata, and rerun Selenium plus `./gradlew spotlessApply check`. (_2025-10-09 – Added stored replay sample actions, JS wiring, and Selenium assertions. Verified via `./gradlew :rest-api:test --tests "io.openauth.sim.rest.ui.TotpOperatorUiSeleniumTest"` and concluded with `./gradlew spotlessApply check`.)_
- ☑ T2339 – Reposition the TOTP stored replay “Load sample data” control directly beneath the “Stored credential” selector (matching OCRA), adjust Thymeleaf markup/JS/CSS, update Selenium assertions, and rerun `./gradlew :rest-api:test` followed by `./gradlew spotlessApply check`. (_2025-10-09 – Relocated the sample action block into the stored credential column, refreshed shared console CSS, and validated layout parity via `./gradlew :rest-api:test` plus `./gradlew spotlessApply check`._)
- ☑ T2340 – Add failing application (`TotpSampleApplicationServiceTest`) and REST (`TotpStoredSampleEndpointTest`) cases covering the seeded SHA-512 credential to reproduce the stored replay sample error. (_2025-10-09 – Added `TotpOperatorSampleDataTest` + SHA-512 stored sample assertions; `./gradlew :rest-api:test --tests "io.openauth.sim.rest.TotpStoredSampleEndpointTest.storedSha512SeedSampleReturnsPayload" --tests "io.openauth.sim.rest.ui.TotpOperatorSampleDataTest"` failed prior to the fix, confirming the regression._)
- ☑ T2341 – Update TOTP seed/sample definitions for SHA-512 to use a compliant secret length, refresh deterministic OTP/timestamp metadata, and rerun `./gradlew spotlessApply check`. (_2025-10-09 – Extended the SHA-512 seed secret to 32 bytes, adjusted stored sample expectations, and re-ran the targeted tests above plus `./gradlew spotlessApply check` to validate the fix._)
- ☑ T2342 – Add failing Selenium regression verifying the TOTP inline preset spacing matches the HOTP baseline; run `./gradlew :rest-api:test --tests "io.openauth.sim.rest.ui.TotpOperatorUiSeleniumTest.totpInlinePresetSpacingMatchesHotpBaseline"` expecting failure. (_2025-10-11 – Test asserted the inline/replay sections expose `stack-offset-top-lg`; targeted run failed prior to template update as intended._)
- ☑ T2343 – Apply the shared `stack-offset-top-lg` spacing token to the TOTP evaluate and replay inline sections, then rerun the targeted Selenium suite and `./gradlew spotlessApply check`. (_2025-10-11 – Added Thymeleaf spacing class + Selenium select wait helper, verified via targeted Selenium pass and `./gradlew spotlessApply check`.)_
- ☑ T2344 – Add failing Selenium regression asserting the TOTP Evaluate tab defaults the mode selector to “Inline parameters,” mirroring HOTP/OCRA/FIDO2 behaviour; execute `./gradlew :rest-api:test --tests "io.openauth.sim.rest.ui.TotpOperatorUiSeleniumTest.totpEvaluateDefaultsToInline"` to capture the red state. (_2025-10-11 – Test added and observed red with stored default in place._)
- ☑ T2345 – Update TOTP operator console templates/JS so the Evaluate tab selects inline parameters by default; rerun the targeted Selenium suite and `./gradlew spotlessApply check`. (_2025-10-11 – Implemented inline-first default across markup/JS, updated Selenium callers, ran the full class and project checks to confirm green._)

☑ T2346 – Publish `docs/totp_validation_vectors.json` with RFC 6238 reference cases, update TOTP fixture loaders/tests across core, CLI, REST, and operator UI, and refresh operator/REST how-to guides once the catalogue lands. (_2025-10-13 – Added shared JSON fixture bundle + `TotpJsonVectorFixtures`, rewired core/CLI/REST/UI presets/tests to load from it, and updated docs/knowledge map._)
- ☑ T2347 – Remove the TOTP replay “Load sample data” button, auto-fill OTP/context on stored credential selection, update Selenium/MockMvc coverage, and rerun `./gradlew spotlessApply check`. (_2025-10-15 – Relied on automatic sample hydration by updating `TotpOperatorUiSeleniumTest.storedTotpReplayReturnsMatch` to wait for the fetched values, dropping the redundant manual field writes, and ensuring the stored status hint surfaces once the fetch completes. Validated with `./gradlew :rest-api:test --tests "io.openauth.sim.rest.ui.TotpOperatorUiSeleniumTest"` and the aggregate `./gradlew :rest-api:test`, then executed `./gradlew spotlessApply check`._)
- ☑ T2350 – Stage failing tests for generated evaluation behaviour (application, CLI, REST MockMvc/OpenAPI, operator UI Selenium) and document breaking expectations. (_2025-10-18 – Updated application/REST/CLI/Selenium tests to expect `status=generated`, OTP payloads, read-only inputs; OpenAPI snapshot left failing pending implementation._)
- ☑ T2351 – Implement generation-first evaluation across layers, update telemetry/docs, and rerun targeted suites plus `./gradlew spotlessApply check`. (_2025-10-18 – Adjusted application service, REST/CLI/UI, regenerated OpenAPI snapshots, knowledge map bullet, and ran targeted suites + `./gradlew spotlessApply check`._)
- ☑ T2352 – Remove OTP inputs from TOTP evaluate forms, update JS/Selenium expectations, and rerun targeted `rest-api:test` plus `spotlessApply`. (_2025-10-22 – Updated Thymeleaf templates and `ui/totp/console.js`, refreshed Selenium assertions, executed `./gradlew --no-daemon :rest-api:test --tests "io.openauth.sim.rest.ui.TotpOperatorUiSeleniumTest"` and `./gradlew --no-daemon spotlessApply`._)
