# Current Session Snapshot

> Keep this file up to date across all active chats. Treat it as the single source of truth for in-progress workstreams so every hand-off is instant. Replace the bracketed text and prune sections you do not need.

- Date: 2025-11-09
- Primary branch: `main`
- Other active branches: none
- Last green commands: `node --test rest-api/src/test/javascript/eudi/openid4vp/console.test.js` (2025-11-09 – Feature 040 T4016 JS harness), `OPENAUTH_SIM_PERSISTENCE_DATABASE_PATH=build/tmp/test-credentials.db ./gradlew --no-daemon :rest-api:test --tests "io.openauth.sim.rest.ui.EudiwOperatorUiSeleniumTest.multiPresentationResultsRenderCollapsibleSections"` (2025-11-09 – T4016 Selenium coverage), `./gradlew --no-daemon :ui:test :application:test` (2025-11-09 – T4016 regression gate), `./gradlew --no-daemon spotlessApply check` (2025-11-09 – full pipeline with new EUDIW console JS test plus EMV console re-run), `./gradlew --no-daemon :application:test` (2025-11-08 – Feature 040 T4015b per-presentation trace diagnostics), `OPENAUTH_SIM_PERSISTENCE_DATABASE_PATH=build/tmp/test-credentials.db ./gradlew --no-daemon :rest-api:test --tests "io.openauth.sim.rest.ui.EudiwOperatorUiSeleniumTest"` (2025-11-08 – T4015b verbose trace Selenium coverage), `./gradlew --no-daemon :ui:test` (2025-11-08 – Feature 040 S7 UI harness), `OPENAUTH_SIM_PERSISTENCE_DATABASE_PATH=build/tmp/test-credentials.db ./gradlew --no-daemon :rest-api:test` (2025-11-08 – full facade suite, requires ≥600 s timeout), plus the previously recorded Feature 039/040 baselines (`node --test rest-api/src/test/javascript/emv/console.test.js`, targeted Selenium runs for EMV + TOTP + FIDO2, `OPENAPI_SNAPSHOT_WRITE=true ./gradlew --no-daemon :rest-api:test --tests "io.openauth.sim.rest.OpenApiSnapshotTest"`, `./gradlew --no-daemon :rest-api:test --tests "io.openauth.sim.rest.eudi.openid4vp.Oid4vpRestContractTest"`, `./gradlew --no-daemon :cli:test --tests "io.openauth.sim.cli.eudi.openid4vp.Oid4vpCliContractTest"`, `./gradlew --no-daemon :core:test :application:test`, `./gradlew --no-daemon :application:test :cli:test :core:test :rest-api:test :ui:test`, etc.).
- Build status: Feature 037 shared-secret polish (T3707) wrapped; Feature 038 remains complete with aligned UI previews, accessibility documentation, and the new T3805 preview-offset helper-text removal. Feature 039 now includes inline preset hydration, the Transaction fieldset (T3937), Session key derivation fieldset (T3938), the Branch factor/Height pairing (T3939), the Session key master key/ATC width alignment (T3940/I43), Card configuration isolation (T3941/I44), refreshed Input-from-customer rows (T3942/I45), the single-line session row (T3943/I46), the IV/IPB/IAD single-line controls (T3944/I46), the preview-offset helper-text cleanup (T3945/I46), **and** the evaluate-mode helper removal (T3946/I47). Node console + targeted Selenium runs plus the 600 s `./gradlew --no-daemon spotlessApply check` remain green (full `:rest-api:test` still needs the longer timeout but passes after rerunning the flaky TOTP badge Selenium test). Feature 026 (FIDO2/WebAuthn) stored sanitisation (I45/T2650) is implemented and awaiting owner acceptance. Feature 029 PMD hardening (T2902) continues in parallel. Feature 040 now ships the S6 REST/CLI facades plus S7 UI increments (T4015a layout/banner/sample wiring, T4015b global trace dock parity, and T4016 multi-presentation result cards with copy/download controls + trace IDs); next up is T4018 deep-link & flag consolidation ahead of S8 fixture ingestion follow-ups.
- New workstream kickoff (2025-11-07): Feature 041 – Operator Console JavaScript Modularization & Test Harness now has a Draft specification, feature plan, and tasks checklist; roadmap entry #40 created and the spec remains open so future protocol additions can extend it.
- Clarifications (2025-11-01): EUDIW OpenID4VP simulator scope confirmed—remote OpenID4VP flows only; credential formats include SD-JWT VC plus ISO/IEC 18013-5 mdoc; align with HAIP profile; simulator covers verifier+wallet roles; adopt hybrid fixture strategy (synthetic now, ingest EU conformance vectors when available). 2025-11-06 update: wallet simulator recomputes SD-JWT disclosure hashes from supplied disclosures (Option A).
- Clarifications (2025-11-05): EMV/CAP operator Evaluate panel keeps inline mode active when a sample vector is selected; no automatic switch to stored credential mode.
- Quality gate note: Full pipeline `./gradlew --no-daemon :application:test :cli:test :rest-api:test :ui:test pmdMain pmdTest spotlessApply check` completed 2025-11-05 (Jacoco aggregated report regenerated; branch coverage remains 2161/3087 ≈0.7000) alongside refreshed OpenAPI snapshots for the sanitised EMV credential directory schema.

## Workstream Summary
| Workstream | Status | Last Increment | Next Increment | Notes |
|------------|--------|----------------|----------------|-------|
| Feature 039 – EMV/CAP Simulation Services | In progress | T3951 – Verbose trace schema documentation | T3948 – Verbose trace provenance tests | Evaluate/Replay panels now include inline preset hydration, the Transaction fieldset, Session key derivation grouping, paired Branch/Height rows, master key/ATC single-line row, card configuration isolation, the condensed customer-input grid, IV/IPB/IAD inline inputs, preview-offset helper cleanup, the removal of the inline/stored helper paragraph (with JS/Selenium asserting it stays absent), **and** the 2025-11-09 spec/plan/tasks update that codifies the trace provenance schema ahead of T3948/T3949. Remaining scope focuses on the provenance trace rollout and subsequent EMV/CAP polish. |
| Feature 026 – FIDO2/WebAuthn Attestation Support | In review | I45 – Stored credential secret sanitisation | Owner acceptance sign-off | Sanitisation merged (`bcaad35`): stored credential samples expose only signing key handles + `[stored-server-side]` placeholders; full suite green (2025-11-05). Awaiting owner confirmation to mark the workstream complete. |
| Feature 029 – PMD Rule Hardening | In progress | T2903 (Ruleset expansion & baseline) | T2902 – Governance sync & backlog updates | PMD toolVersion bumped to 7.17.0 with dependency locks refreshed via `--write-locks`; legacy `AssignmentInOperand` findings in CLI `MaintenanceCli`, core `CborDecoder`/`SimpleJson`, and core-ocra `OcraReplayVerifierBenchmark` have been refactored and `./gradlew --no-daemon pmdMain pmdTest` now passes; NonExhaustiveSwitch added permanently with green `pmdMain pmdTest` + `spotlessApply check`. |
| Feature 036 – Verbose Trace Tier Controls | Proposed | — | T3601 – Tier helper specification tests (red) | Spec/plan/tasks drafted 2025-10-25 to deliver shared tier helper and cross-protocol tagging; implementation yet to begin. |
| Feature 041 – Operator Console JS Modularization & Test Harness | Planning | New spec/plan/tasks seeded 2025-11-07 | T4101 – Console asset inventory & extraction notes | Workstream stays in Draft; upcoming increments will extract remaining inline scripts, build the Node harness, and integrate the aggregate Gradle test task before extending to every protocol. |
| Feature 040 – EUDIW OpenID4VP Simulator | In progress | T4016 – Multi-presentation rendering | T4018 – Deep-link & flag consolidation | Validation mode (T4012/T4013) plus REST/CLI facades landed earlier this week; the latest S7 increments delivered fixture ingestion toggles (T4019/T4020), how-to guides/telemetry snapshot (T4021), trace dock parity (T4015b), and now collapsible multi-presentation result cards with per-section copy/download controls + Selenium/JS coverage (T4016). T4018 is underway: plan/tasks now call for adding the `protocol=eudiw` alias + tab/mode hydration JS (Node + Selenium coverage) and aligning REST/CLI verbose traces via a shared builder, refreshed OpenAPI snapshots, and targeted CLI/REST tests before closing with `spotlessApply check`. |
| _Reminder_ |  |  |  | Keep this table limited to active workstreams; move completed features to the roadmap instead of tracking them here. |

> Open questions live exclusively in `docs/4-architecture/open-questions.md`; consult that log for any pending clarifications.

## Reference Links
- Roadmap entries: `docs/4-architecture/roadmap.md` (Workstreams 27, 34, 35, 40)
- Additional spec: `docs/4-architecture/specs/feature-029-pmd-rule-hardening.md`
- Additional plan: `docs/4-architecture/feature-plan-029-pmd-rule-hardening.md`
- Additional tasks: `docs/4-architecture/tasks/feature-029-pmd-rule-hardening.md`
- Spec (Feature 041): `docs/4-architecture/specs/feature-041-operator-console-js-test-harness.md`
- Plan (Feature 041): `docs/4-architecture/feature-plan-041-operator-console-js-test-harness.md`
- Tasks (Feature 041): `docs/4-architecture/tasks/feature-041-operator-console-js-test-harness.md`
- Spec (Feature 040): `docs/4-architecture/specs/feature-040-eudiw-openid4vp-simulator.md`
- Plan (Feature 040): `docs/4-architecture/feature-plan-040-eudiw-openid4vp-simulator.md`
- Tasks (Feature 040): `docs/4-architecture/tasks/feature-040-eudiw-openid4vp-simulator.md`
- Quick reference: `docs/5-operations/session-quick-reference.md`

> Update this snapshot before ending each session and after significant context changes.
