# Current Session Snapshot

> Keep this file up to date across all active chats. Treat it as the single source of truth for in-progress workstreams so every hand-off is instant. Replace the bracketed text and prune sections you do not need.

- Date: 2025-11-11
- Primary branch: `main`
- Other active branches: none
- Hook guard log (2025-11-11 – Directory provenance Q&A): `git config core.hooksPath` -> `githooks` captured ahead of the credential-expansion / next-gent-simulators / ocra-simulator audit.
- Placeholder retirement (2025-11-11 – user request): Updated the roadmap + feature layout README to document that Features 014+ will create their final directories when prioritised, then removed `docs/4-architecture/features/{credential-expansion,next-gen-simulators,ocra-simulator}` since no active specs lived there.
- Hook guard log (2025-11-11 – Evaluation Q&A session): `git config core.hooksPath` -> `githooks` (verification only; no additional hooks or Gradle targets executed per user's “evaluation only” request).
- Hook guard log (2025-11-11 – Batch P3 Step 6 doc sync): `git config core.hooksPath` -> `githooks` recorded ahead of the roadmap/knowledge-map/runbook refresh so Feature 011 tracking includes the global document sync.
- Hook guard log (2025-11-11 – Stage/commit sync for user request): `git config core.hooksPath` -> `githooks`; `./githooks/pre-commit` exited 0 with no stdout; `./githooks/commit-msg /tmp/tmp.hbt7Yx2DCp` -> `[commit-msg] Running gitlint` plus `3: B5 Body message is too short (4<20): "body"` from gitlint.
- Hook guard log (2025-11-11 – Roadmap regression investigation): `git config core.hooksPath` -> `githooks`; duplicate entry recorded here for Feature 011 tracking.
- Roadmap restoration (2025-11-11 – user request): `git checkout 27b9fa6 -- docs/4-architecture/roadmap.md` to revive the pre-migration Implementation Roadmap after the regression report, followed by `./gradlew --no-daemon spotlessApply check` (doc-only run took 25 s, 96 actionable tasks: 2 executed, 94 up-to-date).
- Clarification gate (2025-11-11): Recorded a new entry in `docs/4-architecture/open-questions.md` requesting direction on what the consolidated roadmap should include (Feature 001–013? additional placeholders?) and reran `./gradlew --no-daemon spotlessApply check` (8 s, configuration cache reused, 96 actionable tasks: 2 executed, 94 up-to-date) to cover the doc edit.
- Governance scrub (2025-11-11 – user request): Removed the remaining legacy migration-log references across AGENTS + specs/plans/tasks, confirmed repository-wide search returns no matches, and reran `./gradlew --no-daemon spotlessApply check` (17 s, 96 actionable tasks: 5 executed, 91 up-to-date).
- Roadmap rewrite (2025-11-11 – user request): Reauthored `docs/4-architecture/roadmap.md` to list consolidated Features 001–013 plus placeholder slots 014+, removed the pending roadmap open question, and left migration references out per owner instructions.
- Roadmap links (2025-11-11 – user request): Swapped the references column to use relative `[spec] · [plan] · [tasks]` links (e.g., `features/001/spec.md`) so rendered viewers resolve correctly and reran `./gradlew --no-daemon spotlessApply check` (15 s, config cache reused, 96 actionable tasks: 2 executed, 94 up-to-date).
- Batch P3 legacy relocation (2025-11-11): Restored Feature 009 legacy directories via `git checkout -- docs/4-architecture/features/009/legacy` and copied legacy specs/plans/tasks for Features 007/008, 019/032, 002/027/028, and 010–015/029/030/031 into the new `legacy/<old-id>/` trees under Features 010–013 using `python` helpers that call `git show origin/main:docs/4-architecture/features/<old-id>/<file>`. Removed the obsolete `docs/4-architecture/features/new-012` staging directory once the copies landed.
- Verification (2025-11-11): `./gradlew --no-daemon spotlessApply check` (doc-only renumbering guard) succeeded after the legacy relocation so Batch P3 can proceed to the remaining reference updates.
- Spec/Plan/Tasks rewrite (2025-11-11): Added legacy coverage tables + checklists for Features 009–013 (specs, plans, tasks) so Batch P3 Steps 3–5 can close before the remaining doc sync; updated plan increments (Feature 011/013 P3-I2) and reran spotless afterwards.
- Verification (2025-11-11 #3): `./gradlew --no-daemon spotlessApply check` after the spec/plan/tasks rewrite updates (configuration cache rebuilt, build successful in 22 s).
- Verification (2025-11-11 – Stage/commit sync for user request): `./gradlew --no-daemon spotlessApply check` succeeded in 20 s (96 actionable tasks: 2 executed, 94 up-to-date).
- Batch P2 redo (2025-11-11): Copied the full Feature 024/026/039/040 specs, plans, and tasks into Features 004/005/006, deleted the `legacy/024`, `legacy/026`, `legacy/039`, and `legacy/040` folders after the targeted suites, and rewrote Feature 004’s spec/plan/tasks to merge the duplicated FR/S/T entries into the template content now displayed above.
- Batch P3 Step 6 global doc sync (2025-11-11): Updated the roadmap, knowledge map, analysis-gate checklist, and quality-gate runbook to reference Features 009–013 (operator console, documentation/knowledge automation, governance, persistence, toolchain). Audited how-to guides for the same references; no edits were required.
- Batch P3 Step 3 legacy cleanup (2025-11-11): Removed the remaining `docs/4-architecture/features/{010,011,012,013}/legacy/` trees via `rm -rf` and confirmed each directory now only contains `{plan.md,spec.md,tasks.md}` using `ls docs/4-architecture/features/<NNN>`.
- Staging directory audit (2025-11-11): `for d in docs/4-architecture/features/operator-console docs/4-architecture/features/docs-and-quality docs/4-architecture/features/platform-foundations; do if [ -d "$d" ]; then echo "exists: $d"; else echo "missing: $d"; fi; done` -> all three reported `missing`, so no additional cleanup needed.
- Batch P3 legacy cleanup (2025-11-11): Removed `docs/4-architecture/features/003/legacy/004`, reran the hook guard (`git config core.hooksPath` -> `githooks`; `tmp_index=$(mktemp); ... ./githooks/pre-commit` still reports “fatal: unable to write new index file” before “No staged changes detected; skipping hook”), and reran `./gradlew --no-daemon spotlessApply check` so the rewrite log records the doc-only deletion plus its verification gate.
- Verification log (2025-11-11): Hook guard rerun (`git config core.hooksPath` -> `githooks`) plus `tmp_index=$(mktemp); GIT_INDEX_FILE=$tmp_index git read-tree --empty; GIT_INDEX_FILE=$tmp_index ./githooks/pre-commit`, `./gradlew --no-daemon spotlessApply check` (rerun, documented after deleting `docs/4-architecture/features/003/legacy/004`), `./gradlew --no-daemon :rest-api:test --tests "io.openauth.sim.rest.*WebAuthn*"`, `node --test rest-api/src/test/javascript/emv/console.test.js`, `OPENAUTH_SIM_PERSISTENCE_DATABASE_PATH=build/tmp/test-credentials.db ./gradlew --no-daemon :rest-api:test --tests "io.openauth.sim.rest.ui.EmvCapOperatorUiSeleniumTest"`, and `./gradlew --no-daemon :ui:test` all succeeded after removing the `docs/4-architecture/features/{004,005,006}/legacy` directories.
- Last green commands: `rm -rf docs/4-architecture/features/operator-console docs/4-architecture/features/docs-and-quality docs/4-architecture/features/platform-foundations docs/4-architecture/features/new-010 docs/4-architecture/features/new-012` (2025-11-11 – Batch P3 Phase 2 legacy tree cleanup for Features 009–013), `./gradlew --no-daemon spotlessApply check` (2025-11-11 – legacy cleanup verification), `git config core.hooksPath` (2025-11-11 – Feature 011 T-011-04 hook guard log), `tmp_index=$(mktemp); GIT_INDEX_FILE=$tmp_index git read-tree --empty; GIT_INDEX_FILE=$tmp_index ./githooks/pre-commit` (2025-11-11 – Feature 011 T-011-04 dry-run), `./gradlew --no-daemon spotlessApply check` (2025-11-11 – Feature 011–013 cross-doc sync verification), `./gradlew --no-daemon qualityGate` (2025-11-11 – Feature 013 command-suite verification), `./gradlew --no-daemon spotlessApply check` (2025-11-11 – Batch P3 Feature 009 scaffolding/legacy relocation), `./gradlew --no-daemon spotlessApply check` (2025-11-11 – Batch P2 doc relocation verification), `./gradlew --no-daemon spotlessApply check` (2025-11-11 – Batch P1 renumbering verification), `./gradlew --no-daemon spotlessApply check` (2025-11-10 – Feature 005 template refresh verification), `./gradlew --no-daemon spotlessApply check` (2025-11-10 – Feature 004 template refresh verification), `./gradlew --no-daemon spotlessApply check` (2025-11-10 – Feature 003 template refresh verification), `./gradlew --no-daemon spotlessApply check` (2025-11-10 – Feature 002 template refresh verification), `./gradlew --no-daemon spotlessApply check` (2025-11-10 – Feature 001 template refresh verification), `./gradlew --no-daemon spotlessApply check` (2025-11-10 – template refresh sweep for Features 036/029/041/039/026), `OPENAPI_SNAPSHOT_WRITE=true ./gradlew --no-daemon :rest-api:test --tests "io.openauth.sim.rest.OpenApiSnapshotTest"` (2025-11-09 – provenance schema snapshot regenerated), `./gradlew --no-daemon --console=plain :application:test`, `./gradlew --no-daemon --console=plain :cli:test`, `./gradlew --no-daemon --console=plain :rest-api:test` (full EMV + EUDIW suites), `./gradlew --no-daemon --console=plain :ui:test`, `./gradlew --no-daemon --console=plain pmdMain pmdTest`, `./gradlew --no-daemon --console=plain spotlessApply check`, `node --test rest-api/src/test/javascript/emv/console.test.js`, and `OPENAUTH_SIM_PERSISTENCE_DATABASE_PATH=build/tmp/test-credentials.db ./gradlew --no-daemon :rest-api:test --tests "io.openauth.sim.rest.ui.EmvCapOperatorUiSeleniumTest"`. All commands completed successfully after copying `trace-provenance-example.json` into `rest-api/docs/test-vectors/emv-cap/`. Additional doc-only verification: `./gradlew --no-daemon spotlessApply check` (2025-11-09 – Implementation Drift Gate sweep) remained green after the roadmap/how-to updates.
- Hook guard verification (2025-11-11 session reset): `git config core.hooksPath` -> `githooks`.
- Build status: Feature 039’s Implementation Drift Gate is complete—console assets render all six provenance sections, REST/CLI/application layers honour `includeTrace` opt-outs, the canonical fixture now lives in both `docs/test-vectors` and `rest-api/docs/test-vectors`, the drift report is logged, and the aggregate Gradle gate is green. Feature 040 is unblocked and can resume at T4018 (console alias/history wiring + verbose builder consolidation) while Feature 041 planning remains unchanged. Note: a malformed CLI invocation (`./gradlew --no-daemon spotlessApply check,workdir:`) failed immediately because of the stray argument comma; reran the command without the typo before logging the Feature 011–013 verification results.
- New workstream kickoff (2025-11-07): Feature 041 – Operator Console JavaScript Modularization & Test Harness now has a Draft specification, feature plan, and tasks checklist; roadmap entry #40 created and the spec remains open so future protocol additions can extend it.
- Clarifications (2025-11-01): EUDIW OpenID4VP simulator scope confirmed—remote OpenID4VP flows only; credential formats include SD-JWT VC plus ISO/IEC 18013-5 mdoc; align with HAIP profile; simulator covers verifier+wallet roles; adopt hybrid fixture strategy (synthetic now, ingest EU conformance vectors when available). 2025-11-06 update: wallet simulator recomputes SD-JWT disclosure hashes from supplied disclosures (Option A).
- Clarifications (2025-11-05): EMV/CAP operator Evaluate panel keeps inline mode active when a sample vector is selected; no automatic switch to stored credential mode.
- Quality gate note: Full pipeline `./gradlew --no-daemon :application:test :cli:test :rest-api:test :ui:test pmdMain pmdTest spotlessApply check` completed 2025-11-05 (Jacoco aggregated report regenerated; branch coverage remains 2161/3087 ≈0.7000) alongside refreshed OpenAPI snapshots for the sanitised EMV credential directory schema.

## Workstream Summary
| Workstream | Status | Last Increment | Next Increment | Notes |
|------------|--------|----------------|----------------|-------|
| Feature 039 – EMV/CAP Simulation Services | In review | T3952 – Implementation Drift Gate | Owner acceptance hand-off | Drift Gate verifies spec R1–R10 coverage, dual `trace-provenance-example.json` fixtures stay mirrored, roadmap/how-to docs now carry the sync requirement, and `./gradlew --no-daemon spotlessApply check` remained green post-doc sweep. 2025-11-10: spec/plan/tasks refreshed to the latest templates (metadata table, verification log) ahead of acceptance. Awaiting owner sign-off before archiving the workstream. |
| Feature 026 – FIDO2/WebAuthn Attestation Support | In review | I45 – Stored credential secret sanitisation | Owner acceptance sign-off | Sanitisation merged (`bcaad35`): stored credential samples expose only signing key handles + `[stored-server-side]` placeholders; full suite green (2025-11-05). 2025-11-10: spec/plan/tasks rewriteed to the new template (metadata tables, FR/NFR, interface catalogue, task log). Awaiting owner confirmation to mark the workstream complete. |
| Feature 029 – PMD Rule Hardening | In progress | T2903 (Ruleset expansion & baseline) | T2902 – Governance sync & backlog updates | 2025-11-10: Spec/plan/tasks rewriteed to the new templates with metadata tables, catalogue entries, and task intents; PMD toolVersion bumped to 7.17.0 with dependency locks refreshed via `--write-locks`; legacy `AssignmentInOperand` findings refactored and `./gradlew --no-daemon pmdMain pmdTest` stays green with NonExhaustiveSwitch enabled. |
| Feature 036 - Verbose Trace Tier Controls | Proposed | — | T-036-01 - Tier helper specification tests (red) | 2025-11-11: Spec, plan, and tasks rewritten to the refreshed templates (metadata table, FR/NFR catalogue, S-036 scenario matrix, interface catalogues, Spec DSL, templated increments/tasks). Implementation still pending; next action is to stage failing helper tests under I1/T-036-01. |
| Feature 041 – Operator Console JS Modularization & Test Harness | Planning | New spec/plan/tasks seeded 2025-11-07 | T4101 – Console asset inventory & extraction notes | 2025-11-10: Spec/plan/tasks refreshed to the new template, including harness DSL + governance checklists; workstream remains Draft until console suites land. |
| Feature 040 – EUDIW OpenID4VP Simulator | In progress | T-040-23 – Live Trusted Authority ingestion | I11 – Drift gate + final documentation | Owner directive Option A executed 2025-11-10: Features 036/029/041 rewriteed to new templates. 2025-11-10 follow-up: Feature 040 spec/plan/tasks now use the refined templates (FR/NFR tables, S-040 scenarios, T-040 tasks) with T4018/T4019/T4020 already green and T-040-23 queued before Drift Gate finalisation. |
| _Reminder_ |  |  |  | Keep this table limited to active workstreams; move completed features to the roadmap instead of tracking them here. |

> Open questions live exclusively in `docs/4-architecture/open-questions.md`; consult that log for any pending clarifications.

## Reference Links
- Roadmap entries: `docs/4-architecture/roadmap.md` (Workstreams 27, 34, 35, 40)
- Additional spec: `docs/4-architecture/features/029/spec.md`
- Additional plan: `docs/4-architecture/features/029/plan.md`
- Additional tasks: `docs/4-architecture/features/029/tasks.md`
- Additional spec: `docs/4-architecture/features/036/spec.md`
- Additional plan: `docs/4-architecture/features/036/plan.md`
- Additional tasks: `docs/4-architecture/features/036/tasks.md`
- Spec (Feature 041): `docs/4-architecture/features/041/spec.md`
- Plan (Feature 041): `docs/4-architecture/features/041/plan.md`
- Tasks (Feature 041): `docs/4-architecture/features/041/tasks.md`
- Spec (Feature 040): `docs/4-architecture/features/040/spec.md`
- Plan (Feature 040): `docs/4-architecture/features/040/plan.md`
- Tasks (Feature 040): `docs/4-architecture/features/040/tasks.md`
- Quick reference: `docs/5-operations/session-quick-reference.md`

> Update this snapshot before ending each session and after significant context changes.
